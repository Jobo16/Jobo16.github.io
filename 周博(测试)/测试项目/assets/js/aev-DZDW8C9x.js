import{g as z}from"./category-DvOjyH99.js";import{H as G,s as H,r as a,o as S,d as J,e as s,j as o,C as t,D as p,R as K,c as P,i as g,k as _,f as W,S as X,U as Y,t as Z}from"../index-DYxDfolO.js";import{i as ee,A as te}from"./index-Bg3NuP4d.js";const{get:oe,post:le,put:be,delt:ne}=G,T="/script",$e=c=>oe(`${T}/findAll`,c),se=c=>le(`${T}/saveOrUpdate`,c),ke=c=>ne(`${T}/${c}`),ae=H({__name:"SelectMaterial",emits:["confirm"],setup(c,{expose:x,emit:v}){const R=p(),i=p([]),y=v;return x({dialogRef:R}),(h,n)=>{const m=a("BaDialog");return S(),J(m,{ref_key:"dialogRef",ref:R,width:"1000px",title:"选择素材",onConfirm:n[1]||(n[1]=({visible:r,loading:k})=>y("confirm",{visible:r,loading:k,selected:t(i)}))},{default:s(()=>[o(ee,{isSelect:"",onSelectionChange:n[0]||(n[0]=r=>i.value=r)})]),_:1},512)}}}),de={class:"flex --Gap"},ie={class:"flex-auto"},re={class:"g-card"},ue={class:"g-card-title"},pe={class:"--MarginT flex"},ce={class:"ml20"},me={key:0,class:"g-card"},fe={class:"g-card flex-none mt0 w-[375px]"},u=9,ge={__name:"aev",setup(c,{expose:x}){const v=K();Y(),X().query.isDetail;const i=p({}),y=p(),h={expandTrigger:"hover",checkStrictly:!0,children:"children",label:"name",value:"id",emitPath:!1},n=p([]),m=p("素材"),r=p("0"),k=p([]);function q(){z("13").then(({data:d})=>{d.forEach(e=>{e.children=null}),k.value=d})}q();async function A(d){return await y.value.validate(),v.loading=!0,se({...i.value,scriptSubs:n.value}).then(()=>{$sdk.msgSuccess("保存成功"),v.loading=!1}).finally(()=>{v.loading=!1})}return x({form:i,formRef:y,groupProps:h,talkList:n,submit:A}),(d,e)=>{var D,M,B,L;const E=a("el-cascader"),V=a("el-form-item"),I=a("el-input"),N=a("el-form"),O=a("el-icon-QuestionFilled"),C=a("el-popover"),b=a("el-button"),w=a("el-dropdown-item"),U=a("el-dropdown-menu"),j=a("el-dropdown"),F=a("DragTable"),Q=a("PhoneChatList");return S(),P("div",de,[g("div",ie,[o(N,{class:"g-card",ref_key:"formRef",ref:y,model:t(i),rules:{title:[d.$sdk.ruleRequiredBlur],categoryId:[d.$sdk.ruleRequiredChange]},"label-width":"100px"},{default:s(()=>[o(V,{label:"选择分组",prop:"categoryId"},{default:s(()=>[o(E,{modelValue:t(i).categoryId,"onUpdate:modelValue":e[0]||(e[0]=l=>t(i).categoryId=l),options:t(k),props:h},null,8,["modelValue","options"])]),_:1}),o(V,{label:"话术标题",prop:"title"},{default:s(()=>[o(I,{modelValue:t(i).title,"onUpdate:modelValue":e[1]||(e[1]=l=>t(i).title=l),type:"text",maxlength:32,"show-word-limit":"",placeholder:"请输入话术标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),g("div",re,[g("div",ue,[e[8]||(e[8]=_(" 话术素材 ",-1)),o(C,{trigger:"hover",content:"最多添加"+u+"个素材",placement:"top-start"},{reference:s(()=>[o(O,{class:"el-icon-QuestionFilled"})]),_:1},8,["content"])]),g("div",null,[g("div",pe,[o(C,{trigger:"hover",content:"最多添加"+u+"个"+t(m)+"，如需修改请删除已有"+t(m)+"后重新尝试",placement:"top-start",disabled:((D=t(n))==null?void 0:D.length)<u},{reference:s(()=>{var l,f;return[o(j,{onCommand:e[2]||(e[2]=$=>(r.value=$,d.$refs.dialogRef.action())),disabled:((l=t(n))==null?void 0:l.length)>u||((f=t(n))==null?void 0:f.length)===u},{dropdown:s(()=>[o(U,{trigger:"click"},{default:s(()=>[o(w,{command:"4"},{default:s(()=>[o(b,{text:""},{default:s(()=>[...e[9]||(e[9]=[_("文本",-1)])]),_:1})]),_:1}),o(w,{command:"0"},{default:s(()=>[o(b,{text:""},{default:s(()=>[...e[10]||(e[10]=[_("图片",-1)])]),_:1})]),_:1}),o(w,{command:"9"},{default:s(()=>[o(b,{text:""},{default:s(()=>[...e[11]||(e[11]=[_("图文",-1)])]),_:1})]),_:1})]),_:1})]),default:s(()=>[o(b,{type:"primary"},{default:s(()=>[_(Z("新建"+t(m)),1)]),_:1})]),_:1},8,["disabled"])]}),_:1},8,["content","disabled"]),o(t(te),{ref:"dialogRef",type:t(r),dynamicTitle:(M=d.$sdk.dictMaterialType[t(r)])==null?void 0:M.name,onConfirm:e[3]||(e[3]=({form:l,visible:f,loading:$})=>d.$refs.dialogRef.$refs.form.validate().then(()=>{l.value._index?t(n)[l.value._index]=l.value:t(n).push(l.value),f.value=!1}).finally(()=>$.value=!1))},null,8,["type","dynamicTitle"]),o(C,{trigger:"hover",content:"最多添加"+u+"个"+t(m)+"，如需修改请删除已有"+t(m)+"后重新尝试",placement:"top-start",disabled:((B=t(n))==null?void 0:B.length)<u},{reference:s(()=>{var l;return[g("div",ce,[o(b,{onClick:e[4]||(e[4]=f=>d.$refs.dialogSelectMaterialRef.dialogRef.visible=!0),disabled:((l=t(n))==null?void 0:l.length)>=u},{default:s(()=>[...e[12]||(e[12]=[_(" 从素材中心选择 ",-1)])]),_:1},8,["disabled"])])]}),_:1},8,["content","disabled"]),o(t(ae),{ref:"dialogSelectMaterialRef",onConfirm:e[5]||(e[5]=({visible:l,loading:f,selected:$})=>{t(n).push(...$),l.value=!1,f.value=!1})},null,512)])])]),(L=t(n))!=null&&L.length?(S(),P("div",me,[o(F,{data:t(n),onChange:e[6]||(e[6]=l=>n.value=l),onEdit:e[7]||(e[7]=l=>(r.value=d.$sdk.dictMaterialType[l.msgtype].type,d.$refs.dialogRef.action(l))),dargAble:!0},null,8,["data"])])):W("",!0)]),g("div",fe,[o(Q,{list:t(n)},null,8,["list"])])])}}},xe=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));export{ge as _,xe as a,ke as d,$e as g};
