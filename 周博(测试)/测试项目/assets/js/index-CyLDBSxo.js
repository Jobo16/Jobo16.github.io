const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/HistoryMsg-U-dmLMTy.js","assets/index-DYxDfolO.js","assets/css/index-DwPq-yKK.css","assets/js/MsgForm-C9cqKKlA.js","assets/css/MsgForm-CPX_6tcj.css"])))=>i.map(i=>d[i]);
import{H as m,_ as E,c as b,w as T,F as x,h as B,i as n,j as i,k as d,e as o,B as I,a as q,r,z as S,o as g,t as y,f as h,d as w}from"../index-DYxDfolO.js";const f="/agent";function D(){return m({url:f+"/findAll"})}function P(t){return m({url:f+`/${t}`,method:"delete"})}function F(t){return m({url:f+"/saveOrUpdate",method:"post",data:t})}function z(t){return m({url:f+`/synchAgent/${t}`,method:"get"})}const R={getList(t){return m({url:f+"/findAgentSubAll/"+t.agentId,params:t})},add(t){return m({url:f+"/sendAgentMsg",method:"post",data:t})}},G={components:{HistoryMsg:I(()=>S(()=>import("./HistoryMsg-U-dmLMTy.js"),__vite__mapDeps([0,1,2]))),MsgForm:I(()=>S(()=>import("./MsgForm-C9cqKKlA.js"),__vite__mapDeps([3,1,2,4])))},props:{},data(){return{query:{},form:{},list:[],dialogVisible:!1,disabled:!1,loading:!1,rules:Object.freeze({agentId:[{required:!0,message:"必填项",trigger:"blur"}],name:[{required:!0,message:"必填项",trigger:"blur"}],description:[{required:!0,message:"必填项",trigger:"blur"}],logoUrl:[{required:!0,message:"必填项",trigger:"change"}]}),formMsg:{},dialogVisibleHistoryMsg:!1,dialogVisibleSendMsg:!1,disabledMsg:!1}},watch:{},computed:{},created(){this.getList(),this.$store.setBusininessDesc("<div>企业微信自建应用管理，支持通过应用发送应用消息</div> ")},mounted(){},methods:{getList(t){this.loading=!0,D().then(({data:e,total:U})=>{e.forEach(p=>{p.allowPartyName=(p.allowPartyName||"").split(","),p.allowUserinfoName=(p.allowUserinfoName||"").split(",")}),this.list=e}).finally(()=>{this.loading=!1})},sync(t){z(t.id).then(({data:e})=>{Object.assign(t,e),this.getList(),this.msgSuccess("操作成功")})},edit(t,e){this.form=Object.assign({},t||{}),this.dialogVisible=!0,e||!t?this.disabled=!1:this.disabled=!0,this.$nextTick(()=>{this.$refs.form.clearValidate()})},submit(){this.$refs.form.validate(t=>{t&&(this.form.agentId=Number(this.form.agentId),F(this.form).then(()=>{this.msgSuccess("操作成功"),this.dialogVisible=!1,this.getList()}).catch(()=>{this.dialogVisible=!1}))})},remove(t){this.$confirm("是否确认删除？该操作不可撤销，请谨慎操作。",{title:"警告",confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return P(t)}).then(()=>{this.getList(),this.msgSuccess("删除成功")})},submitSendMsg(t){t?(t.agentSub=[Object.assign({},t)],R.add(t).then(()=>{this.msgSuccess("操作成功"),this.dialogVisibleSendMsg=!1,this.dialogVisibleHistoryMsg&&this.$refs.historyMsg.getList()})):this.dialogVisibleSendMsg=!1}}},J={class:"list-wrap"},K={class:"list-item"},Q={class:"flex"},W={class:""},X={class:"title blod toe"},Y={class:"desc"},Z={class:"flex aic mt10"},$={class:"flex aic mt10"},ee={class:"list-action fxbw"},le={class:"ac flex aic cp theme list-item",style:{"justify-content":"center"}};function se(t,e,U,p,l,u){const C=r("el-image"),a=r("el-button"),k=r("TagEllipsis"),N=r("el-icon-plus"),_=r("el-input"),c=r("el-form-item"),A=r("upload"),L=r("el-form"),v=r("el-drawer"),H=r("HistoryMsg"),O=r("MsgForm"),j=q("loading");return g(),b("div",null,[T((g(),b("ul",J,[(g(!0),b(x,null,B(l.list,(s,M)=>(g(),b("li",{key:M,class:"list"},[n("div",K,[n("div",Q,[i(C,{src:s.logoUrl,fit:"fill"},null,8,["src"]),n("div",W,[n("div",X,y(s.name),1),n("div",Y,y(s.description),1),i(a,{type:"primary",plain:"",onClick:V=>u.sync(s)},{default:o(()=>[...e[11]||(e[11]=[d("同步",-1)])]),_:1},8,["onClick"])])]),n("div",Z,[e[12]||(e[12]=n("div",{class:"list-label"},"AgentId",-1)),d(" "+y(s.agentId),1)]),n("div",$,[e[13]||(e[13]=n("div",{class:"list-label"},"可见范围",-1)),i(k,{list:s.allowPartyName},null,8,["list"]),i(k,{list:s.allowUserinfoName},null,8,["list"])]),n("div",ee,[i(a,{text:"",onClick:V=>{l.formMsg={agentName:s.name,agentId:s.agentId},l.disabledMsg=!1,l.dialogVisibleSendMsg=!0}},{default:o(()=>[...e[14]||(e[14]=[d(" 发送消息 ",-1)])]),_:1},8,["onClick"]),i(a,{text:"",onClick:V=>{l.formMsg={agentName:s.name,agentId:s.agentId},l.dialogVisibleHistoryMsg=!0}},{default:o(()=>[...e[15]||(e[15]=[d(" 历史消息 ",-1)])]),_:1},8,["onClick"]),i(a,{text:"",onClick:V=>u.edit(s)},{default:o(()=>[...e[16]||(e[16]=[d("编辑",-1)])]),_:1},8,["onClick"]),i(a,{text:"",onClick:V=>u.remove(s.id)},{default:o(()=>[...e[17]||(e[17]=[d("删除",-1)])]),_:1},8,["onClick"])])])]))),128)),n("li",{class:"list",onClick:e[0]||(e[0]=s=>u.edit())},[n("div",le,[i(N,{class:"el-icon-plus"}),e[18]||(e[18]=d(" 添加应用 ",-1))])])])),[[j,l.loading]]),i(v,{title:l.form.id?"编辑":"添加",modelValue:l.dialogVisible,"onUpdate:modelValue":e[7]||(e[7]=s=>l.dialogVisible=s),"close-on-click-modal":!1,size:"580px"},{footer:o(()=>[n("div",null,[i(a,{onClick:e[6]||(e[6]=s=>l.dialogVisible=!1)},{default:o(()=>[...e[21]||(e[21]=[d("取 消",-1)])]),_:1}),i(a,{type:"primary",onClick:u.submit},{default:o(()=>[...e[22]||(e[22]=[d("确 定",-1)])]),_:1},8,["onClick"])])]),default:o(()=>[i(L,{ref:"form","label-position":"right",model:l.form,rules:l.rules,"label-width":"80px"},{default:o(()=>[i(c,{label:"应用ID",prop:"agentId"},{default:o(()=>[i(_,{modelValue:l.form.agentId,"onUpdate:modelValue":e[1]||(e[1]=s=>l.form.agentId=s),placeholder:"请输入应用 AgentId"},null,8,["modelValue"]),e[19]||(e[19]=n("div",{class:"dialog-tip"},"如何获取：企微后台->应用管理->自建应用详情->AgentId",-1))]),_:1}),i(c,{label:"应用密钥",prop:"secret",rules:{required:!l.form.agentId,message:"必填项",trigger:"blur"}},{default:o(()=>[i(_,{modelValue:l.form.secret,"onUpdate:modelValue":e[2]||(e[2]=s=>l.form.secret=s),placeholder:"请输入应用 Secret"},null,8,["modelValue"]),e[20]||(e[20]=n("div",{class:"dialog-tip"},"如何获取：企微后台->应用管理->自建应用详情->Secret",-1))]),_:1},8,["rules"]),l.form.id?(g(),b(x,{key:0},[i(c,{label:"应用名称",prop:"name"},{default:o(()=>[i(_,{modelValue:l.form.name,"onUpdate:modelValue":e[3]||(e[3]=s=>l.form.name=s),maxlength:"16","show-word-limit":"",placeholder:"请输入应用名称"},null,8,["modelValue"])]),_:1}),i(c,{label:"应用描述",prop:"description"},{default:o(()=>[i(_,{type:"textarea",modelValue:l.form.description,"onUpdate:modelValue":e[4]||(e[4]=s=>l.form.description=s),maxlength:"60","show-word-limit":"",placeholder:"请输入应用描述"},null,8,["modelValue"])]),_:1}),i(c,{label:"应用头像",prop:"logoUrl"},{default:o(()=>[i(A,{class:"image-uploader",fileUrl:l.form.logoUrl,"onUpdate:fileUrl":e[5]||(e[5]=s=>l.form.logoUrl=s),type:"0"},null,8,["fileUrl"])]),_:1})],64)):h("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),i(v,{title:"历史消息",modelValue:l.dialogVisibleHistoryMsg,"onUpdate:modelValue":e[9]||(e[9]=s=>l.dialogVisibleHistoryMsg=s),"close-on-click-modal":!1},{default:o(()=>[l.dialogVisibleHistoryMsg?(g(),w(H,{key:0,ref:"historyMsg",id:l.formMsg.agentId,onEdit:e[8]||(e[8]=(s,M)=>{l.dialogVisibleSendMsg=!0,l.disabledMsg=M==="detail",l.formMsg=Object.assign({agentId:l.formMsg.agentId,agentName:l.formMsg.agentName},s)})},null,8,["id"])):h("",!0)]),_:1},8,["modelValue"]),i(v,{title:"发送消息",modelValue:l.dialogVisibleSendMsg,"onUpdate:modelValue":e[10]||(e[10]=s=>l.dialogVisibleSendMsg=s),"close-on-click-modal":!1},{default:o(()=>[l.dialogVisibleSendMsg?(g(),w(O,{key:0,data:l.formMsg,disabled:l.disabledMsg,onSubmit:u.submitSendMsg},null,8,["data","disabled","onSubmit"])):h("",!0)]),_:1},8,["modelValue"])])}const te=E(G,[["render",se],["__scopeId","data-v-2713cc12"]]),oe=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{R as a,oe as i};
