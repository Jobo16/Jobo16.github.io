import{s as G,r as i,o as C,d as R,e as n,j as t,C as l,D as f,_ as F,c as q,i as x,S as B,M as Q,k,f as z,F as Y,h as J}from"../index-DYxDfolO.js";import{_ as K,a as O,g as P,b as X,h as Z,c as ee,f as te}from"./index-D56qHnSo.js";const oe=G({__name:"SelectHotWord",emits:["confirm"],setup(m,{expose:a,emit:r}){const d=f(),p=f([]),A=r;return a({dialogRef:d}),(T,c)=>{const _=i("BaDialog");return C(),R(_,{ref_key:"dialogRef",ref:d,title:"选择热词",onConfirm:c[1]||(c[1]=({visible:y,loading:s})=>A("confirm",{visible:y,loading:s,selected:l(p)}))},{default:n(()=>[t(K,{isSelect:"",onSelectionChange:c[0]||(c[0]=y=>p.value=y)})]),_:1},512)}}});let{aiHotWordAnalysis:L}={};const le={props:{data:{}},data(){return{aiHotWordAnalysis:L}=O,{rules:{time:[{required:!0,message:"请输入客户与员工的聊天时间段",trigger:"blur"}]},form:{time:null}}},methods:{formatDate(m){const a=m.getFullYear(),r=(m.getMonth()+1).toString().padStart(2,"0"),d=m.getDate().toString().padStart(2,"0");return`${a}-${r}-${d}`},async submit(){var a,r;let m=await this.$refs.form.validate();console.log(m),m&&L({startTime:this.formatDate((a=this.form.time)==null?void 0:a[0]),endTime:this.formatDate((r=this.form.time)==null?void 0:r[1])}).then(d=>{this.msgSuccess(d.msg)}).finally(()=>{this.$store.loading=!1})}}},ae={class:""};function re(m,a,r,d,p,A){const T=i("el-date-picker"),c=i("el-form-item"),_=i("el-form");return C(),q("div",ae,[t(_,{ref:"form",rules:p.rules,model:p.form,"label-position":"right","label-width":"100px","scroll-into-view-options":!0},{default:n(()=>[t(c,{label:"时间:",prop:"time","aria-required":"true"},{default:n(()=>[t(T,{modelValue:p.form.time,"onUpdate:modelValue":a[0]||(a[0]=y=>p.form.time=y),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"]),a[1]||(a[1]=x("br",null,null,-1)),a[2]||(a[2]=x("span",{style:{color:"#f00","font-size":"12px"}}," 请选择指定时间段内客户的与员工的会话内容进行热词分析(受限于大模型的单词会话,每次分析建议时间间隔小一点) ",-1))]),_:1})]),_:1},8,["rules","model"])])}const ne=F(le,[["render",re]]),se={class:"fxbw"},ie={class:"grid grid-cols-2 --Gap --MarginT"},ue={__name:"statistics",setup(m){let a=f(!1);B().query.id;let r=f({}),d=f([]);(function(){a.value=!0,P().then(({data:e={}})=>{d.value=[{title:"热词讨论总数",tips:"预设的热词讨论累计总数",value:e.discussTotalNumber||0}]}).finally(()=>{a.value=!1})})();let p=f([]);function A(o,e,$){if(e.length=0,p.value=[],o!=null&&o.length){let b=[];o.forEach(h=>{p.value.push(h.hotWord),b.push(h.hotWordDiscussNumber)}),e.push(b)}}const T=f([]);function c(){X().then(({data:o})=>{T.value=o})}c();let _=f([]);function y(o,e,$){if(e.length=0,_.value=[],o!=null&&o.length){let b=[];o.forEach(h=>{_.value.push(h.hotWord),b.push(h.hotWordDiscussNumber)}),e.push(b)}}const s=Q({loading:!1,id:B().query.id,dialogAiVisible:!1,form:{}}),M=()=>{s.form={},s.dialogAiVisible=!0},w=f(),U=()=>{s.loading=!0,w.value.submit().then(()=>{s.dialogAiVisible=!1}).catch(o=>console.error(o)).finally(()=>s.loading=!1)};return(o,e)=>{const $=i("el-button"),b=i("el-dialog"),h=i("CardGroup"),D=i("RequestChartTable"),H=i("el-option"),j=i("el-select"),N=i("el-form-item"),E=i("el-input"),V=i("el-table-column");return C(),q("div",null,[x("div",se,[t($,{type:"primary",onClick:M},{default:n(()=>[...e[7]||(e[7]=[k("AI热词分析",-1)])]),_:1})]),e[10]||(e[10]=x("br",null,null,-1)),t(b,{title:"AI会话预审",modelValue:l(s).dialogAiVisible,"onUpdate:modelValue":e[1]||(e[1]=u=>l(s).dialogAiVisible=u),width:"80%","close-on-click-modal":!1},{footer:n(()=>[t($,{onClick:e[0]||(e[0]=u=>l(s).dialogAiVisible=!1)},{default:n(()=>[...e[8]||(e[8]=[k("取消",-1)])]),_:1}),t($,{type:"primary",onClick:U,loading:l(s).loading},{default:n(()=>[...e[9]||(e[9]=[k("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[l(s).dialogAiVisible?(C(),R(ne,{key:0,data:l(s).form,ref_key:"synchRef",ref:w},null,8,["data"])):z("",!0)]),_:1},8,["modelValue"]),t(h,{data:l(d)},null,8,["data"]),x("div",ie,[t(D,{title:"热词Top5",type:"barChart",isTimeQuery:"",request:Z,option:{xAxis:[{type:"value"}],yAxis:[{type:"category",data:l(p)}]},dealDataFun:A},null,8,["request","option"]),t(D,{class:"mt0",ref:"rctRef",title:"分类热词 Top5",type:"barChart",isTimeQuery:"",searchBtnType:!1,request:ee,option:{xAxis:[{type:"value"}],yAxis:[{type:"category",data:l(_)}]},dealDataFun:y},{queryMiddle:n(({query:u})=>[t(N,{label:"热词分类",prop:"categoryId"},{default:n(()=>[t(j,{modelValue:u.categoryId,"onUpdate:modelValue":v=>u.categoryId=v,"popper-append-to-body":!1,onChange:e[2]||(e[2]=v=>o.$refs.rctRef.getList())},{default:n(()=>[(C(!0),q(Y,null,J(l(T),(v,g)=>(C(),R(H,{key:g,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["request","option"])]),t(D,{ref:"rctRef2",type:"table",title:"热词讨论明细",isTimeQuery:"",request:te,params:l(r),onReset:e[6]||(e[6]=u=>{l(r)._name="",l(r).hotWordId=""})},{queryMiddle:n(({})=>[t(N,{label:"选择热词",prop:"categoryId"},{default:n(()=>[t(E,{modelValue:l(r)._name,"onUpdate:modelValue":e[3]||(e[3]=u=>l(r)._name=u),placeholder:"请选择热词",onClick:e[4]||(e[4]=u=>o.$refs.selectHotWordRef.dialogRef.visible=!0)},null,8,["modelValue"]),t(oe,{ref:"selectHotWordRef",onConfirm:e[5]||(e[5]=({visible:u,loading:v,selected:g})=>{var S,I;return l(r)._name=(S=g==null?void 0:g.map(W=>W.hotWord))==null?void 0:S.join(","),l(r).hotWordIds=(I=g==null?void 0:g.map(W=>W.id))==null?void 0:I.join(","),u.value=!1,v.value=!1,o.$nextTick(()=>{o.$refs.rctRef2.getList(1)})})},null,512)]),_:1})]),table:n(({data:u})=>[t(V,{label:"热词讨论客户",prop:"fromName"}),t(V,{label:"会话员工",prop:"acceptName","show-overflow-tooltip":""}),t(V,{label:"热词",prop:"hotWordName"}),t(V,{label:"热词分类",prop:"categoryName"}),t(V,{label:"会话原文",prop:"content","min-width":"160px","show-overflow-tooltip":""}),t(V,{label:"讨论时间",prop:"msgTime","show-overflow-tooltip":""})]),_:1},8,["request","params"])])}}},me=F(ue,[["__scopeId","data-v-a5bd52ef"]]);export{me as default};
