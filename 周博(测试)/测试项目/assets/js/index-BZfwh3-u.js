import{H as z,s as G,E as H,r as n,o as f,c as k,j as t,G as M,e as s,C as b,k as y,F as U,h as w,d as B,i as S,D as m,_ as O}from"../index-DYxDfolO.js";import J from"./TagEllipsis-CcQ_ZfLe.js";/* empty css                                                                    */const{get:R,post:E,put:re,delt:de}=z,V="/customerInfo",K="/tag",P=a=>R(`${V}/findAll`,a),Q=a=>E(`${V}/synchCustomer`,a),X=a=>R(`${K}/findTag`,a),Y=a=>E(`${V}/tagCustomers`,a),Z=["_"],ee={class:"tag-selector"},te={class:"dialog-footer"},le=G({__name:"index",props:{isSelect:{type:Boolean,default:!1}},emits:["selectionChange"],setup(a,{emit:oe}){const $=m(),p=m(!1),g=m([]),r=m([]),T=m([]),I=m(""),L=Object.freeze({1:"微信客户",2:"企业客户"}),h=async()=>{try{const l=await X({});l.code===200&&(g.value=l.data||[])}catch(l){console.error("获取客户标签失败:",l)}},q=async l=>{if(T.value=[l.externalUserid],I.value=l.userId||"",g.value.length===0&&await h(),l.tagIds){const e=l.tagIds.split(",").map(c=>c.trim());r.value=e.filter(c=>g.value.some(_=>_.id===c))}else r.value=[];p.value=!0},D=async()=>{var l;if(r.value.length===0){$sdk.msgWarning("请选择标签");return}try{const e=await Y({externalUserid:T.value[0],tagIds:r.value,userId:I.value});e.code===200?($sdk.msgSuccess("打标签成功"),p.value=!1,(l=$.value)==null||l.getList()):$sdk.msgError(e.msg||"打标签失败")}catch(e){console.error("打标签失败:",e),$sdk.msgError("打标签失败")}};return H(()=>{h()}),(l,e)=>{const c=n("el-input"),_=n("el-form-item"),N=n("el-option"),x=n("el-select"),v=n("el-button"),j=n("CustomerInfoCell"),u=n("el-table-column"),A=n("RequestChartTable"),F=n("el-dialog");return f(),k("div",{_:l.$store.setBusininessDesc("<div>查看当前企业所有的客户及详细信息</div>")},[t(A,{ref_key:"rctRef",ref:$,request:b(P),searchBtnType:"icon",onSelectionChange:e[1]||(e[1]=o=>l.$emit("selectionChange",o))},M({query:s(({query:o})=>[t(_,{label:"客户名称",prop:"customerName"},{default:s(()=>[t(c,{modelValue:o.customerName,"onUpdate:modelValue":d=>o.customerName=d,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(_,{label:"客户类型",prop:"type"},{default:s(()=>[t(x,{modelValue:o.type,"onUpdate:modelValue":d=>o.type=d,"popper-append-to-body":!1},{default:s(()=>[(f(!0),k(U,null,w(b(L),(d,C)=>(f(),B(N,{key:C,label:d,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),table:s(({data:o,apiConfirm:d,goRoute:C})=>[t(u,{label:"客户",prop:"customerName","header-align":"center",align:"",width:"180"},{default:s(({row:i})=>[t(j,{data:i,onClick:W=>C(i)},null,8,["data","onClick"])]),_:2},1024),t(u,{prop:"tagNames",label:"客户标签",align:"center",width:"220"},{default:s(({row:i})=>[t(b(J),{list:i.tagNames||[],emptyText:"无标签"},null,8,["list"])]),_:1}),t(u,{label:"跟进员工","min-width":"100",prop:"userName"}),t(u,{prop:"addWay",label:"客户来源"}),t(u,{label:"添加时间",prop:"addTime",width:""}),t(u,{label:"操作",fixed:"right",width:"80"},{default:s(({row:i})=>[t(v,{text:"",onClick:W=>q(i)},{default:s(()=>[...e[7]||(e[7]=[y("打标签",-1)])]),_:1},8,["onClick"])]),_:1})]),_:2},[a.isSelect?void 0:{name:"operation",fn:s(({selectedIds:o})=>[t(v,{type:"primary",onClick:e[0]||(e[0]=d=>b(Q)().then(()=>l.$refs.rctRef.getList(),l.$sdk.msgSuccess()))},{default:s(()=>[...e[6]||(e[6]=[y(" 同步 ",-1)])]),_:1})]),key:"0"}]),1032,["request"]),t(F,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),title:"选择标签",width:"500px",onClose:e[5]||(e[5]=()=>r.value=[])},{footer:s(()=>[S("span",te,[t(v,{onClick:e[3]||(e[3]=o=>p.value=!1)},{default:s(()=>[...e[8]||(e[8]=[y("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:D},{default:s(()=>[...e[9]||(e[9]=[y("确定",-1)])]),_:1})])]),default:s(()=>[S("div",ee,[t(x,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value=o),multiple:"",placeholder:"请选择标签",style:{width:"100%"},"popper-append-to-body":!1,"fit-input-width":!1},{default:s(()=>[(f(!0),k(U,null,w(g.value,o=>(f(),B(N,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])],8,Z)}}}),ue=O(le,[["__scopeId","data-v-9c74dbca"]]);export{ue as default};
