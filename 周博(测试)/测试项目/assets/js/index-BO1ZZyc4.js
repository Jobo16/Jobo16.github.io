import{a as D}from"./api-BqHkVYlB.js";import{_ as S,c as _,i as p,j as l,e as o,w,P as G,r as i,o as c,k as g,F as L,h as E,d as U}from"../index-DYxDfolO.js";/* empty css                                                                    */let{getList:y,synchChat:b,getGroupTags:T,tagGroups:C}={};const z={data(){return{getList:y,synchChat:b,getGroupTags:T,tagGroups:C}=D,{activeName:"first",list:"",total:0,multipleSelection:[],loading:!1,dialogVisible:!1,tagDialogVisible:!1,groupTags:[],selectedTags:[],selectedGroupIds:[],selectedChatId:"",form:{},queryParm:{chatName:null,page:1,size:10},options:[],xData:[],series:[],tabCount:{}}},watch:{},created(){this.getList(),this.loadGroupTags()},mounted(){},methods:{getList(t){t==null&&(t=this.queryParm),this.$store.loading=!0,console.log(t),y(t).then(e=>{this.list=e.data,this.total=e.count,this.multipleSelection=[]}).catch(e=>console.error(e)).finally(()=>this.$store.loading=!1)},getData(){var t={chatName:this.queryParm.chatName,page:this.queryParm.page,size:this.queryParm.size};this.getList(t)},synchChat(){b().then(t=>{this.msgSuccess(t.msg)}).catch(t=>console.error(t)).finally(()=>this.$store.loading=!1)},restting(){this.queryParm.chatName=null,this.getData()},formatStatus(t){return{1:"已激活",2:"已禁用",4:"未激活",5:"退出企业"}[t.status]||"未知状态"},formatDate(t){const e=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),u=t.getDate().toString().padStart(2,"0");return`${e}-${r}-${u}`},loadGroupTags(){T({}).then(t=>{t.code===200&&(this.groupTags=t.data||[])}).catch(t=>console.error("获取标签列表失败:",t))},handleTagGroup(t){if(this.selectedGroupIds=[t.msgId],this.selectedChatId=t.chatId,t.tagIds){const e=t.tagIds.split(",").map(r=>r.trim());this.selectedTags=e.filter(r=>this.groupTags.some(u=>u.id===r))}else this.selectedTags=[];this.tagDialogVisible=!0},submitTags(){if(this.selectedTags.length===0){this.msgWarning("请选择标签");return}C({externalUserid:this.selectedGroupIds[0],chatId:this.selectedChatId,tagIds:this.selectedTags}).then(t=>{t.code===200?(this.msgSuccess("打标签成功"),this.tagDialogVisible=!1,this.getList()):this.msgError(t.msg||"打标签失败")}).catch(t=>{console.error("打标签失败:",t),this.msgError("打标签失败")})},msgSuccess(t){this.$message.success(t)},msgWarning(t){this.$message.warning(t)},msgError(t){this.$message.error(t)}}},F={class:"g-card"},B={class:"fxbw"},M={class:"tag-selector"},W={class:"dialog-footer"};function j(t,e,r,u,a,n){const V=i("el-input"),h=i("el-form-item"),m=i("el-button"),v=i("el-form"),d=i("el-table-column"),k=i("TagEllipsis"),P=i("el-table"),I=i("pagination"),q=i("el-option"),N=i("el-select"),x=i("el-dialog");return c(),_("div",null,[p("div",F,[l(v,{class:"searchForm",ref:"searchForm",model:a.queryParm,"label-width":"",inline:""},{default:o(()=>[l(h,{label:"群名称:",prop:"value3"},{default:o(()=>[l(V,{modelValue:a.queryParm.chatName,"onUpdate:modelValue":e[0]||(e[0]=s=>a.queryParm.chatName=s),placeholder:""},null,8,["modelValue"])]),_:1}),l(h,null,{default:o(()=>[l(m,{type:"primary",onClick:n.getData},{default:o(()=>[...e[10]||(e[10]=[g("查询",-1)])]),_:1},8,["onClick"]),l(m,{onClick:n.restting},{default:o(()=>[...e[11]||(e[11]=[g("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),p("div",B,[l(m,{type:"primary",onClick:e[1]||(e[1]=s=>n.synchChat())},{default:o(()=>[...e[12]||(e[12]=[g("同步客群",-1)])]),_:1})]),l(P,{data:a.list,"tooltip-effect":"dark","highlight-current-row":"",onSelectionChange:e[2]||(e[2]=s=>a.multipleSelection=s.map(f=>f.msgId))},{default:o(()=>[l(d,{label:"群名称",prop:"chatName"}),l(d,{label:"群主",prop:"ownerName"}),l(d,{prop:"tagNames",label:"客群标签",align:"center",width:"220"},{default:o(({row:s})=>[l(k,{list:s.tagNames||[],emptyText:"无标签"},null,8,["list"])]),_:1}),l(d,{label:"创建时间",prop:"createTime"}),l(d,{label:"操作",fixed:"right",width:"80"},{default:o(({row:s})=>[l(m,{text:"",onClick:f=>n.handleTagGroup(s)},{default:o(()=>[...e[13]||(e[13]=[g("打标签",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),w(l(I,{total:a.total,page:a.queryParm.page,"onUpdate:page":e[3]||(e[3]=s=>a.queryParm.page=s),limit:a.queryParm.size,"onUpdate:limit":e[4]||(e[4]=s=>a.queryParm.size=s),onPagination:e[5]||(e[5]=s=>n.getList())},null,8,["total","page","limit"]),[[G,a.total>0]])]),l(x,{modelValue:a.tagDialogVisible,"onUpdate:modelValue":e[8]||(e[8]=s=>a.tagDialogVisible=s),title:"选择标签",width:"500px",onClose:e[9]||(e[9]=()=>this.selectedTags=[])},{footer:o(()=>[p("span",W,[l(m,{onClick:e[7]||(e[7]=s=>a.tagDialogVisible=!1)},{default:o(()=>[...e[14]||(e[14]=[g("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:n.submitTags},{default:o(()=>[...e[15]||(e[15]=[g("确定",-1)])]),_:1},8,["onClick"])])]),default:o(()=>[p("div",M,[l(N,{modelValue:a.selectedTags,"onUpdate:modelValue":e[6]||(e[6]=s=>a.selectedTags=s),multiple:"",placeholder:"请选择标签",style:{width:"100%"},"popper-append-to-body":!1,"fit-input-width":!1},{default:o(()=>[(c(!0),_(L,null,E(a.groupTags,s=>(c(),U(q,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}const J=S(z,[["render",j],["__scopeId","data-v-b6cb3ab5"]]);export{J as default};
