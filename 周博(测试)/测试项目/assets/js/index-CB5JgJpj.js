import{H as g,_ as z,c as m,j as s,e as r,r as a,a as E,o as d,i,F as y,h as k,t as I,f as J,k as c,d as C,w as H}from"../index-DYxDfolO.js";const P=t=>g({url:"/sessionInterceptRule/findAll",method:"get",params:t}),W=t=>g({url:"/SessionInterceptRule/saveOrUpdate",method:"post",data:t}),A=t=>g({url:`/SessionInterceptRule/${t}`,method:"delete"}),G=t=>g({url:`/SessionInterceptRule/batchDelete/${t}`,method:"delete"}),K=t=>g({url:`/sessionInterceptRule/${t}`,method:"get"}),B=()=>g({url:"/user/findUser",method:"get"}).then(t=>{var e;return t.code==200&&((e=t.data)==null||e.forEach(f=>{f.id=f.userId})),t}),Q=Object.freeze(Object.defineProperty({__proto__:null,batchDelete:G,del:A,getById:K,getList:P,getStaffList:B,saveOrUpdate:W},Symbol.toStringTag,{value:"Module"})),X={props:{},data(){return{api:Q,loading:!1,drawerVisible:!1,form:{ruleName:"",sensitiveWords:"",staffIds:[],interceptType:1,semantics:[]},rules:Object.freeze({ruleName:[{required:!0,message:"必填项",trigger:"blur"}],sensitiveWords:[{required:!0,message:"必填项",trigger:"blur"}],staffIds:[{required:!0,message:"必填项",trigger:"blur"}],interceptType:[{required:!0,message:"必填项",trigger:"change"}]}),staffList:[]}},computed:{},created(){this.getStaffList()},methods:{getStaffList(){B().then(t=>{this.staffList=t.data||[]})},getStaffName(t){if(!t)return"";const e=this.staffList.find(f=>f.id===t||f.userId===t);return e?e.name:t},getSemanticName(t){return{1:"手机号",2:"邮箱地址",3:"红包"}[t]||t},add(){this.form={ruleName:"",sensitiveWords:"",staffIds:[],interceptType:1,staffNames:"",semantics:[]},this.drawerVisible=!0},edit(t){this.form=JSON.parse(JSON.stringify(t)),Array.isArray(this.form.sensitiveWords)&&(this.form.sensitiveWords=this.form.sensitiveWords.join(",")),typeof this.form.staffIds=="string"?this.form.staffIds=this.form.staffIds.split(",").filter(Boolean):Array.isArray(this.form.staffIds)||(this.form.staffIds=[]),typeof this.form.interceptType=="number"&&(this.form.interceptType=this.form.interceptType.toString()),typeof this.form.semantics=="string"?this.form.semantics=this.form.semantics.split(",").filter(Boolean).map(Number):Array.isArray(this.form.semantics)||(this.form.semantics=[]),this.drawerVisible=!0},del(t){this.$confirm("确定要删除这条规则吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A(t.id).then(()=>{this.msgSuccess("删除成功"),this.$refs.rct.getList()})}).catch(()=>{})},handleRemoteSearch(t){t&&(this.loading=!0,setTimeout(()=>{this.loading=!1},200))},submit(){this.$refs.form.validate(t=>{if(t){const e=this.form.sensitiveWords.trim(),f=Array.isArray(this.form.staffIds)?this.form.staffIds.join(","):"",N=Array.isArray(this.form.semantics)?this.form.semantics.join(","):"",o={...this.form,sensitiveWords:e,staffIds:f,semantics:N,interceptType:parseInt(this.form.interceptType),delFlag:this.form.delFlag||0};W(o).then(()=>{this.msgSuccess("操作成功"),this.drawerVisible=!1,this.$refs.rct.getList()})}})}}},Y={class:"violationIntercept"},Z={key:0},$={key:1},ee={class:"checkbox-item"},te={class:"checkbox-item"},se={class:"checkbox-item"},re={class:"radio-item"},le={class:"radio-item"},oe={class:"dialog-footer"};function ie(t,e,f,N,o,b){const L=a("BaInput"),_=a("el-button"),p=a("el-table-column"),R=a("RequestChartTable"),T=a("el-input"),h=a("el-form-item"),V=a("el-checkbox"),U=a("el-checkbox-group"),q=a("el-option"),j=a("el-select"),S=a("el-radio"),O=a("el-radio-group"),D=a("el-form"),M=a("el-drawer"),F=E("preventReClick");return d(),m("div",Y,[s(R,{ref:"rct",request:o.api.getList,searchBtnType:"icon"},{query:r(({query:l})=>[s(L,{label:"规则名称",prop:"ruleName",modelValue:l.ruleName,"onUpdate:modelValue":w=>l.ruleName=w},null,8,["modelValue","onUpdate:modelValue"])]),operate:r(({goRoute:l})=>[s(_,{type:"primary",onClick:b.add},{default:r(()=>[...e[7]||(e[7]=[c("新建规则",-1)])]),_:1},8,["onClick"])]),table:r(({apiConfirm:l,goRoute:w})=>[s(p,{label:"规则名称",align:"center",prop:"ruleName"}),s(p,{label:"敏感词",align:"center",prop:"sensitiveWords"},{default:r(({row:n})=>{var u;return[i("div",null,[(d(!0),m(y,null,k(Array.isArray(n.sensitiveWords)?n.sensitiveWords:((u=n.sensitiveWords)==null?void 0:u.split(","))||[],(v,x)=>(d(),m("span",{key:x,class:"tag"},I(v),1))),128))])]}),_:1}),s(p,{label:"语义类型",align:"center"},{default:r(({row:n})=>[i("div",null,[(d(!0),m(y,null,k(n.semantics?n.semantics.split(",").map(Number):[],(u,v)=>(d(),m("span",{key:v,class:"tag"},I(b.getSemanticName(u)),1))),128))])]),_:1}),s(p,{label:"风控范围",align:"center"},{default:r(({row:n})=>{var u;return[i("div",null,[(d(!0),m(y,null,k(((u=n.staffIds)==null?void 0:u.split(","))||[],(v,x)=>(d(),m("span",{key:x,class:"tag"},I(b.getStaffName(v)),1))),128))])]}),_:1}),s(p,{label:"拦截方式",align:"center",prop:"interceptType"},{default:r(({row:n})=>[n.interceptType===1?(d(),m("span",Z,"警告并拦截")):n.interceptType===2?(d(),m("span",$,"仅警告")):J("",!0)]),_:1}),s(p,{label:"最近更新时间",align:"center",prop:"updateTime"}),s(p,{label:"操作",align:"center"},{default:r(({row:n})=>[s(_,{text:"",onClick:u=>b.edit(n)},{default:r(()=>[...e[8]||(e[8]=[c("编辑",-1)])]),_:1},8,["onClick"]),s(_,{text:"",type:"danger",onClick:u=>b.del(n)},{default:r(()=>[...e[9]||(e[9]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["request"]),s(M,{title:o.form.id?"修改规则":"新增规则","model-value":o.drawerVisible,"onUpdate:modelValue":e[6]||(e[6]=l=>o.drawerVisible=l),width:"500px","append-to-body":"","close-on-click-modal":!1},{footer:r(()=>[i("div",oe,[s(_,{onClick:e[5]||(e[5]=l=>o.drawerVisible=!1)},{default:r(()=>[...e[20]||(e[20]=[c("取消",-1)])]),_:1}),H((d(),C(_,{type:"primary",onClick:b.submit},{default:r(()=>[...e[21]||(e[21]=[c("确定",-1)])]),_:1},8,["onClick"])),[[F,1e3]])])]),default:r(()=>[s(D,{ref:"form",model:o.form,rules:o.rules,"label-width":"100px"},{default:r(()=>[s(h,{label:"规则名称",prop:"ruleName"},{default:r(()=>[s(T,{modelValue:o.form.ruleName,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.ruleName=l),modelModifiers:{trim:!0},maxlength:"20","show-word-limit":"",placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),s(h,{label:"敏感词",prop:"sensitiveWords"},{default:r(()=>[s(T,{modelValue:o.form.sensitiveWords,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.sensitiveWords=l),modelModifiers:{trim:!0},type:"textarea",rows:4,maxlength:"200","show-word-limit":"",placeholder:"请输入敏感词，多个敏感词用英文逗号隔开"},null,8,["modelValue"])]),_:1}),s(h,{label:"额外规则"},{default:r(()=>[s(U,{modelValue:o.form.semantics,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.semantics=l)},{default:r(()=>[i("div",ee,[s(V,{label:1},{default:r(()=>[...e[10]||(e[10]=[i("span",{class:"checkbox-label"},"手机号",-1)])]),_:1}),e[11]||(e[11]=i("div",{class:"checkbox-desc"},"检测和拦截包含手机号码",-1))]),i("div",te,[s(V,{label:2},{default:r(()=>[...e[12]||(e[12]=[i("span",{class:"checkbox-label"},"邮箱地址",-1)])]),_:1}),e[13]||(e[13]=i("div",{class:"checkbox-desc"},"检测和拦截包含邮箱地址",-1))]),i("div",se,[s(V,{label:3},{default:r(()=>[...e[14]||(e[14]=[i("span",{class:"checkbox-label"},"红包",-1)])]),_:1}),e[15]||(e[15]=i("div",{class:"checkbox-desc"},"检测和拦截包含红包",-1))])]),_:1},8,["modelValue"])]),_:1}),s(h,{label:"风控范围",prop:"staffIds"},{default:r(()=>[s(j,{modelValue:o.form.staffIds,"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.staffIds=l),multiple:"",filterable:"","reserve-keyword":"",placeholder:"请选择员工",clearable:"",style:{width:"100%"}},{default:r(()=>[(d(!0),m(y,null,k(o.staffList,l=>(d(),C(q,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(h,{label:"拦截方式",prop:"interceptType"},{default:r(()=>[s(O,{modelValue:o.form.interceptType,"onUpdate:modelValue":e[4]||(e[4]=l=>o.form.interceptType=l),vertical:""},{default:r(()=>[i("div",re,[s(S,{label:"1"},{default:r(()=>[...e[16]||(e[16]=[c("警告并拦截",-1)])]),_:1}),e[17]||(e[17]=i("div",{class:"radio-desc"},"警告员工，且不允许员工发送",-1))]),i("div",le,[s(S,{label:"2"},{default:r(()=>[...e[18]||(e[18]=[c("仅警告",-1)])]),_:1}),e[19]||(e[19]=i("div",{class:"radio-desc"},"警告员工，但允许员工继续发送",-1))])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","model-value"])])}const ae=z(X,[["render",ie],["__scopeId","data-v-b35ea7c9"]]);export{ae as default};
