import{H as J,_ as R,c as P,j as s,e as a,r,o as f,i as y,a as Z,F as Q,h as U,d as A,k as u,t as ee,w as V,P as q,f as x}from"../index-DYxDfolO.js";const{get:S,post:Y,put:Ce,delt:le}=J,c="/msg",te=l=>S(`${c}/findMsgAuditByPage`,l),ie=l=>S(`${c}/findAiAnalysisMsgAudits`,l),se=l=>S(`${c}/findMsgRules`,l),ae=l=>Y(`${c}/saveOrUpdateMsgRule`,l),oe=()=>S(`${c}/synchMsg`),re=l=>S(`${c}/buildAISessionWarning`,l),ne=l=>le(`${c}/${l}`),ue=l=>Y(`${c}/${l}`),k=Object.freeze(Object.defineProperty({__proto__:null,batchStartOrStop:ue,buildAISessionWarning:re,del:ne,findAiAnalysisMsgAudits:ie,findMsgRules:se,getList:te,saveOrUpdateMsgRule:ae,synchMsg:oe},Symbol.toStringTag,{value:"Module"})),{get:Me,post:we,put:Ne,delt:De}=J;let{saveOrUpdateMsgRule:O}={};const me={props:{data:{}},data(){return{saveOrUpdateMsgRule:O}=k,{rules:{ruleContent:[{required:!0,message:"请输入规则内容",trigger:"blur"}]},form:{ruleType:1,id:null,ruleContent:""}}},created(){this.data!=null&&(console.log(this.data.id),console.log(this.data.ruleContent),this.form.ruleContent=this.data.ruleContent,this.form.id=this.data.id)},methods:{async submit(){if(!await this.$refs.form.validate())return;let e=JSON.parse(JSON.stringify(this.form));O(e).then(({data:o})=>{this.msgSuccess("操作成功")}).finally(()=>{this.$store.loading=!1})}}},de={class:""};function pe(l,e,o,g,t,n){const b=r("el-input"),v=r("el-form-item"),p=r("el-form");return f(),P("div",de,[s(p,{ref:"form",rules:t.rules,model:t.form,"label-position":"right","label-width":"100px","scroll-into-view-options":!0},{default:a(()=>[s(v,{label:"规则内容",prop:"ruleContent"},{default:a(()=>[s(b,{type:"textarea",rows:4,modelValue:t.form.ruleContent,"onUpdate:modelValue":e[0]||(e[0]=_=>t.form.ruleContent=_),maxlength:"100","show-word-limit":"",clearable:"",placeholder:"请输入"},null,8,["modelValue"]),e[1]||(e[1]=y("br",null,null,-1)),e[2]||(e[2]=y("span",{style:{color:"#f00","font-size":"12px"}}," 请清晰填写相关规则 ",-1))]),_:1})]),_:1},8,["rules","model"])])}const fe=R(me,[["render",pe]]);let{saveOrUpdateMsgRule:ge,buildAISessionWarning:I}={};const ye={props:{data:{}},data(){return{saveOrUpdateMsgRule:ge,buildAISessionWarning:I}=k,{rules:{time:[{required:!0,message:"请输入员工与客户的聊天时间段",trigger:"blur"}]},form:{time:null}}},methods:{formatDate(l){const e=l.getFullYear(),o=(l.getMonth()+1).toString().padStart(2,"0"),g=l.getDate().toString().padStart(2,"0");return`${e}-${o}-${g}`},async submit(){var e,o;let l=await this.$refs.form.validate();console.log(l),l&&I({msgAuditType:1,startTime:this.formatDate((e=this.form.time)==null?void 0:e[0]),endTime:this.formatDate((o=this.form.time)==null?void 0:o[1])}).then(({data:g})=>{this.msgSuccess("操作成功")}).finally(()=>{this.$store.loading=!1})}}},ce={class:""};function he(l,e,o,g,t,n){const b=r("el-date-picker"),v=r("el-form-item"),p=r("el-form");return f(),P("div",ce,[s(p,{ref:"form",rules:t.rules,model:t.form,"label-position":"right","label-width":"100px","scroll-into-view-options":!0},{default:a(()=>[s(v,{label:"时间:",prop:"time","aria-required":"true"},{default:a(()=>[s(b,{modelValue:t.form.time,"onUpdate:modelValue":e[0]||(e[0]=_=>t.form.time=_),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"]),e[1]||(e[1]=y("br",null,null,-1)),e[2]||(e[2]=y("span",{style:{color:"#f00","font-size":"12px"}}," 请选择员工与客户指定时间段内的聊天内容进行预审 ",-1))]),_:1})]),_:1},8,["rules","model"])])}const be=R(ye,[["render",he]]);let{getList:z,findAiAnalysisMsgAudits:L,synchMsg:W,buildAISessionWarning:F,findMsgRules:$,del:j,saveOrUpdateMsgRule:ve,batchStartOrStop:B}={};const _e={data(){return{getList:z,findAiAnalysisMsgAudits:L,synchMsg:W,buildAISessionWarning:F,findMsgRules:$,del:j,saveOrUpdateMsgRule:ve,batchStartOrStop:B}=k,{activeName:"first",list:"",aiList:"",aiRuleList:"",total:0,aiTotal:0,aiRuleTotal:0,multipleSelection:[],loading:!1,dialogVisible:!1,dialogAiVisible:!1,form:{},queryParm:{fromName:null,acceptName:null,time:null,acceptType:1,page:1,size:10},aiQueryParm:{warning:null,employeeName:null,customerName:null,time:null,msgAuditType:1,page:1,size:10},aiRuleParm:{ruleStatus:null,ruleType:1,page:1,size:10},options:[],xData:[],series:[],tabCount:{},options:[{key:"全部",val:null},{key:"违规",val:!0},{key:"不违规",val:!1}],aiRuleOptions:[{key:"全部",val:null},{key:"启用",val:!0},{key:"停用",val:!1}]}},components:{aev:fe,synch:be},watch:{},created(){this.getList(),this.getData(),this.findAiAnalysisMsgAudits(),this.findMsgRules()},mounted(){},methods:{openDialog(){this.dialogAiVisible=!0},getList(l){l==null&&(l=this.queryParm),this.$store.loading=!0,console.log(l),z(l).then(e=>{this.list=e.data,this.total=e.count,this.multipleSelection=[]}).catch(e=>console.error(e)).finally(()=>this.$store.loading=!1)},del(l){let e=l;this.$confirm().then(()=>(this.$store.loading=!0,j(e).then(o=>{this.msgSuccess("删除成功"),this.findMsgRules()}))).catch(o=>{console.error(o)})},findAiAnalysisMsgAudits(l){l==null&&(l=this.aiQueryParm),this.$store.loading=!0,console.log(l),L(l).then(({data:e,count:o})=>{this.aiList=e,this.aiTotal=+o,this.multipleSelection=[]}).catch(e=>console.error(e)).finally(()=>this.$store.loading=!1)},findMsgRules(l){l==null&&(l=this.aiRuleParm),this.$store.loading=!0,console.log(l),$(l).then(({data:e,count:o})=>{this.aiRuleList=e,this.aiRuleTotal=+o,this.multipleSelection=[]}).catch(e=>console.error(e)).finally(()=>this.$store.loading=!1)},submit(){this.loading=!0,this.$refs.aev.submit().then(()=>(this.dialogVisible=!1,this.findMsgRules())).catch(l=>console.error(l)).finally(()=>this.loading=!1)},submitAiVisible(){this.loading=!0,this.$refs.synch.submit().then(()=>{this.dialogAiVisible=!1}).catch(l=>console.error(l)).finally(()=>this.loading=!1)},synchChatMsg(){W().then(l=>{this.msgSuccess(l.msg)}).catch(l=>console.error(l)).finally(()=>this.$store.loading=!1)},buildAISessionWarning(){F().then(l=>{this.msgSuccess(l.msg)}).catch(l=>console.error(l)).finally(()=>this.$store.loading=!1)},getData(){var e,o;var l={fromName:this.queryParm.fromName,acceptName:this.queryParm.acceptName,startTime:this.queryParm.time===null?null:this.formatDate((e=this.queryParm.time)==null?void 0:e[0]),endTime:this.queryParm.time===null?null:this.formatDate((o=this.queryParm.time)==null?void 0:o[1]),acceptType:1,page:this.queryParm.page,size:this.queryParm.size};this.getList(l)},getAIData(){var e,o;var l={warning:this.aiQueryParm.warning,employeeName:this.aiQueryParm.employeeName,customerName:this.aiQueryParm.customerName,startTime:this.aiQueryParm.time===null?null:this.formatDate((e=this.aiQueryParm.time)==null?void 0:e[0]),endTime:this.aiQueryParm.time===null?null:this.formatDate((o=this.aiQueryParm.time)==null?void 0:o[1]),msgAuditType:1,page:this.aiQueryParm.page,size:this.aiQueryParm.size};this.findAiAnalysisMsgAudits(l)},getAIRuleData(){var l={ruleStatus:this.aiRuleParm.ruleStatus,ruleType:1,page:this.aiRuleParm.page,size:this.aiRuleParm.size};this.findMsgRules(l)},restting(){this.queryParm.fromName=null,this.queryParm.acceptName=null,this.queryParm.time=null,this.getData()},resttingAi(){this.aiQueryParm.warning=null,this.aiQueryParm.employeeName=null,this.aiQueryParm.customerName=null,this.aiQueryParm.time=null,this.getAIData()},resttingRuleAi(){this.aiRuleParm.ruleStatus=null,this.getAIRuleData()},formatDate(l){const e=l.getFullYear(),o=(l.getMonth()+1).toString().padStart(2,"0"),g=l.getDate().toString().padStart(2,"0");return`${e}-${o}-${g}`},formatWarning(l,e,o){return o?"违规":"不违规"},formatStartOrStop(l,e,o){return o?"启用":"停用"},formatDefaultRule(l,e,o){return o?"默认":"非默认"},formatDateTimeRange(l,e){return!l||!e?"-":`${l} 至 ${e}`},handleStatusChange(){var l,e;console.log((e=(l=this.multipleSelection)==null?void 0:l.join)==null?void 0:e.call(l,",")),this.$confirm("是否需要启用或停用该条规则").then(()=>{var o,g;return B((g=(o=this.multipleSelection)==null?void 0:o.join)==null?void 0:g.call(o,",")).then(t=>{this.msgSuccess("操作成功"),this.findMsgRules()})}).catch(o=>{console.error(o)})}}},Ae={class:"g-card"},Pe={class:"fxbw"},Se={class:"g-card"},Ve={class:"fxbw"};function Re(l,e,o,g,t,n){const b=r("el-option"),v=r("el-select"),p=r("el-form-item"),_=r("el-input"),E=r("el-date-picker"),m=r("el-button"),C=r("el-form"),d=r("el-table-column"),M=r("el-table"),w=r("pagination"),H=r("synch"),N=r("el-dialog"),D=r("el-tab-pane"),G=r("el-switch"),K=r("aev"),X=r("el-tabs"),T=Z("loading");return f(),P("div",null,[s(X,{modelValue:t.activeName,"onUpdate:modelValue":e[20]||(e[20]=i=>t.activeName=i)},{default:a(()=>[s(D,{label:"AI会话预审",name:"first"},{default:a(()=>[e[26]||(e[26]=y("div",{class:"warning"},[y("strong",null," 依据预审规则,借助AI大模型对员工所发送给【客户】的聊天内容进行审核 。 ")],-1)),y("div",Ae,[s(C,{class:"searchForm",ref:"searchForm",model:l.query2,"label-width":"",inline:""},{default:a(()=>[s(p,{label:"是否违规:",prop:"value3"},{default:a(()=>[s(v,{modelValue:t.aiQueryParm.warning,"onUpdate:modelValue":e[0]||(e[0]=i=>t.aiQueryParm.warning=i),"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,placeholder:"全部",style:{width:"260px"}},{default:a(()=>[(f(!0),P(Q,null,U(t.options,i=>(f(),A(b,{key:i.val,label:i.key,value:i.val},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,{label:"员工名称:",prop:"value3"},{default:a(()=>[s(_,{modelValue:t.aiQueryParm.employeeName,"onUpdate:modelValue":e[1]||(e[1]=i=>t.aiQueryParm.employeeName=i),placeholder:""},null,8,["modelValue"])]),_:1}),s(p,{label:"客户名称:",prop:"value3"},{default:a(()=>[s(_,{modelValue:t.aiQueryParm.customerName,"onUpdate:modelValue":e[2]||(e[2]=i=>t.aiQueryParm.customerName=i),placeholder:""},null,8,["modelValue"])]),_:1}),s(p,{label:"时间:"},{default:a(()=>[s(E,{modelValue:t.aiQueryParm.time,"onUpdate:modelValue":e[3]||(e[3]=i=>t.aiQueryParm.time=i),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(m,{type:"primary",onClick:n.getAIData},{default:a(()=>[...e[21]||(e[21]=[u("查询",-1)])]),_:1},8,["onClick"]),s(m,{onClick:n.resttingAi},{default:a(()=>[...e[22]||(e[22]=[u("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),y("div",Pe,[s(m,{type:"primary",onClick:e[4]||(e[4]=i=>{t.form={},t.dialogAiVisible=!0})},{default:a(()=>[...e[23]||(e[23]=[u("AI会话预审",-1)])]),_:1})]),s(M,{data:t.aiList,"tooltip-effect":"dark","highlight-current-row":"",onSelectionChange:e[5]||(e[5]=i=>t.multipleSelection=i.map(h=>h.id))},{default:a(()=>[s(d,{label:"员工名称",prop:"employeeName"}),s(d,{label:"客户名称",prop:"customerName"}),s(d,{label:"员工是否有违规",prop:"warning",formatter:n.formatWarning},null,8,["formatter"]),s(d,{label:"数据分析时间范围"},{default:a(({row:i})=>[u(ee(n.formatDateTimeRange(i.startTime,i.endTime)),1)]),_:1}),s(d,{label:"违规提示",prop:"msg"}),s(d,{label:"分析时间",prop:"createTime"})]),_:1},8,["data"]),V(s(w,{total:t.aiTotal,page:t.aiQueryParm.page,"onUpdate:page":e[6]||(e[6]=i=>t.aiQueryParm.page=i),limit:t.aiQueryParm.size,"onUpdate:limit":e[7]||(e[7]=i=>t.aiQueryParm.size=i),onPagination:e[8]||(e[8]=i=>n.findAiAnalysisMsgAudits())},null,8,["total","page","limit"]),[[q,t.aiTotal>0]]),s(N,{title:"AI会话预审",modelValue:t.dialogAiVisible,"onUpdate:modelValue":e[10]||(e[10]=i=>t.dialogAiVisible=i),width:"80%","close-on-click-modal":!1},{footer:a(()=>[s(m,{onClick:e[9]||(e[9]=i=>t.dialogAiVisible=!1)},{default:a(()=>[...e[24]||(e[24]=[u("取消",-1)])]),_:1}),V((f(),A(m,{type:"primary",onClick:n.submitAiVisible},{default:a(()=>[...e[25]||(e[25]=[u("确定",-1)])]),_:1},8,["onClick"])),[[T,t.loading]])]),default:a(()=>[t.dialogAiVisible?(f(),A(H,{key:0,data:t.form,ref:"synch"},null,8,["data"])):x("",!0)]),_:1},8,["modelValue"])])]),_:1}),s(D,{label:"AI预审规则",name:"second"},{default:a(()=>[y("div",Se,[s(C,{class:"searchForm",ref:"searchForm",model:l.query2,"label-width":"",inline:""},{default:a(()=>[s(p,{label:"规则状态:",prop:"value3"},{default:a(()=>[s(v,{modelValue:t.aiRuleParm.ruleStatus,"onUpdate:modelValue":e[11]||(e[11]=i=>t.aiRuleParm.ruleStatus=i),"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,placeholder:"全部",style:{width:"260px"}},{default:a(()=>[(f(!0),P(Q,null,U(t.aiRuleOptions,i=>(f(),A(b,{key:i.val,label:i.key,value:i.val},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(m,{type:"primary",onClick:n.getAIRuleData},{default:a(()=>[...e[27]||(e[27]=[u("查询",-1)])]),_:1},8,["onClick"]),s(m,{onClick:n.resttingRuleAi},{default:a(()=>[...e[28]||(e[28]=[u("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),y("div",Ve,[s(m,{type:"primary",onClick:e[12]||(e[12]=i=>{t.form={},t.dialogVisible=!0})},{default:a(()=>[...e[29]||(e[29]=[u("新建",-1)])]),_:1}),s(m,{disabled:!t.multipleSelection.length,onClick:e[13]||(e[13]=i=>n.handleStatusChange()),type:"danger"},{default:a(()=>[...e[30]||(e[30]=[u("批量启用或停用",-1)])]),_:1},8,["disabled"])]),s(M,{data:t.aiRuleList,"tooltip-effect":"dark","highlight-current-row":"",onSelectionChange:e[14]||(e[14]=i=>t.multipleSelection=i.map(h=>h.id))},{default:a(()=>[s(d,{type:"selection",width:"50",align:"center"}),s(d,{label:"规则内容",prop:"ruleContent"}),s(d,{label:"状态",prop:"ruleStatus"},{default:a(({row:i})=>[s(G,{modelValue:i.ruleStatus,"onUpdate:modelValue":h=>i.ruleStatus=h,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(d,{label:"是否默认",prop:"defaultRule",formatter:n.formatDefaultRule},null,8,["formatter"]),s(d,{label:"创建时间",prop:"createTime"}),s(d,{label:"操作",fixed:"right"},{default:a(({row:i})=>[s(m,{text:"",disabled:i.defaultRule,onClick:h=>{t.form=JSON.parse(JSON.stringify(i)),t.dialogVisible=!0}},{default:a(()=>[...e[31]||(e[31]=[u("编辑",-1)])]),_:1},8,["disabled","onClick"]),s(m,{text:"",disabled:i.defaultRule,onClick:h=>n.del(i.id)},{default:a(()=>[...e[32]||(e[32]=[u("删除",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"]),V(s(w,{total:t.aiRuleTotal,page:t.aiRuleParm.page,"onUpdate:page":e[15]||(e[15]=i=>t.aiRuleParm.page=i),limit:t.aiRuleParm.size,"onUpdate:limit":e[16]||(e[16]=i=>t.aiRuleParm.size=i),onPagination:e[17]||(e[17]=i=>n.findMsgRules())},null,8,["total","page","limit"]),[[q,t.aiRuleTotal>0]]),s(N,{title:t.form.id?"编辑":"新建",modelValue:t.dialogVisible,"onUpdate:modelValue":e[19]||(e[19]=i=>t.dialogVisible=i),width:"80%","close-on-click-modal":!1},{footer:a(()=>[s(m,{onClick:e[18]||(e[18]=i=>t.dialogVisible=!1)},{default:a(()=>[...e[33]||(e[33]=[u("取消",-1)])]),_:1}),V((f(),A(m,{type:"primary",onClick:n.submit},{default:a(()=>[...e[34]||(e[34]=[u("确定",-1)])]),_:1},8,["onClick"])),[[T,t.loading]])]),default:a(()=>[t.dialogVisible?(f(),A(K,{key:0,data:t.form,ref:"aev"},null,8,["data"])):x("",!0)]),_:1},8,["title","modelValue"])])]),_:1})]),_:1},8,["modelValue"])])}const Te=R(_e,[["render",Re],["__scopeId","data-v-babe711f"]]);export{Te as default};
