import{a as re}from"./api-C-XKCTRs.js";import{a as ie,b as ge}from"./apiLink-6ym-kcZt.js";import{_ as ne,c as b,j as t,e as o,r as p,o as g,F as v,h as N,d as y,i,f as U,O as fe,a as ce,I as F,k as u,w as _,P as A,t as D}from"../index-DYxDfolO.js";import{a as he,b as ye,g as ae}from"./common--EZeVx_X.js";import{d as Ce}from"./index-CtSVQMOO.js";let{findMsgAnnexByMsgId:J,findMsgPeriodAnnexByMsgId:K,add:z,update:W}={};const be={props:{data:{}},data(){let r=location.href.includes("customerLink");return{findMsgAnnexByMsgId:J,findMsgPeriodAnnexByMsgId:K,add:z,update:W}=r?ie:re,{rules:{codeName:[{required:!0,message:"请输入活码名称",trigger:"blur"}],users:[{required:!0,message:"请选择",trigger:"change",validator:(e,a,d)=>{a.length==0?d(new Error("请选择")):d()}}],weclomeMsg:[{required:!1,message:"必填项",trigger:"blur"}]},originForm:{beginTime:"",endTime:"",workCycle:[],weclomeMsg:"您好，很高兴为您服务，请问有什么可以帮您？"},form:{codeName:"",skipVerify:1,tags:[],users:[],remarkType:null,logoUrl:null,startPeriodAnnex:!0},selectedUserList:[],selectedTagList:[],userList:[],userErrorTip:"",tagList:[],tagErrorTip:"",remarkList:[],annexLists:[],max:9,active:0,dictMsgType:Ce,isLink:r}},computed:{j(){let{startPeriodAnnex:r,weclomeMsg:e,annexLists:a,periodAnnexLists:d}=this.form;return{startPeriodAnnex:r,weclomeMsg:e,annexLists:a,periodAnnexLists:d}}},watch:{data:{deep:!0,immediate:!0,handler(r){let e=JSON.parse(JSON.stringify(r));e.tags=[],e.users=[],e.tagId&&e.tagName&&(e.tagId=e.tagId.split(","),e.tagName=e.tagName.split(","),e.tagId.forEach((a,d)=>{e.tags.push({id:a,name:e.tagName[d]})})),e.userId&&e.userName&&(e.userId=e.userId.split(","),e.userName=e.userName.split(","),e.userId.forEach((a,d)=>{e.users.push({id:a,name:e.userName[d]})})),this.form=e,setTimeout(()=>{this.$refs.form.clearValidate()},0)}}},created(){this.getUserList(),this.getTagList(),this.getRemarkList();let r=this.form.id;r&&this.getDetail(r)},methods:{getUserList(){ae().then(r=>{if(r.code==301){this.userErrorTip=r.msg;return}this.userList=r.data||[]})},getTagList(){ye().then(r=>{if(r.code==301){this.tagErrorTip=r.msg;return}this.tagList=r.data||[]})},getRemarkList(){he().then(r=>{this.remarkList=r.data||[]})},getDetail(r){J(r).then(e=>{console.log(e.data),this.form.annexLists=e.data}),this.form.startPeriodAnnex&&K(r).then(e=>{console.log(e.data),this.form.periodAnnexLists=e.data})},async submit(){if(!await this.$refs.form.validate())return;let e=JSON.parse(JSON.stringify(this.form));e.tagId=e.tags.map(d=>d.id)+"",e.tagName=e.tags.map(d=>d.name)+"",e.userId=e.users.map(d=>d.id)+"",e.userName=e.users.map(d=>d.name)+"";let a=await this.$refs.WelcomeForm.submit();return Object.assign(e,a),(e.id?W:z)(e).then(({data:d})=>{this.msgSuccess("操作成功")}).finally(()=>{this.$store.loading=!1})}}},ve={class:""};function ke(r,e,a,d,l,n){const w=p("el-input"),c=p("el-form-item"),V=p("el-option"),L=p("el-select"),S=p("el-switch"),m=p("Upload"),I=p("WelcomeForm"),h=p("el-form");return g(),b("div",ve,[t(h,{ref:"form",rules:l.rules,model:l.form,"label-position":"right","label-width":"100px","scroll-into-view-options":!0},{default:o(()=>[t(c,{label:"渠道名称",prop:"codeName"},{default:o(()=>[t(w,{modelValue:l.form.codeName,"onUpdate:modelValue":e[0]||(e[0]=f=>l.form.codeName=f),maxlength:"15","show-word-limit":"",clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),t(c,{label:"活码员工",prop:"users",error:l.userErrorTip},{default:o(()=>[t(L,{modelValue:l.form.users,"onUpdate:modelValue":e[1]||(e[1]=f=>l.form.users=f),"value-key":"id",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,placeholder:"请选择"},{default:o(()=>[(g(!0),b(v,null,N(l.userList,f=>(g(),y(V,{key:f.id,label:f.name,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["error"]),t(c,{label:"免验证"},{default:o(()=>[t(S,{modelValue:l.form.skipVerify,"onUpdate:modelValue":e[2]||(e[2]=f=>l.form.skipVerify=f)},null,8,["modelValue"]),e[7]||(e[7]=i("div",{class:"g-tip"},"（注:勾选后,客户添加员工好友无需员工确认）",-1))]),_:1}),l.isLink?U("",!0):(g(),b(v,{key:0},[t(c,{label:"重复添加"},{default:o(()=>[t(S,{modelValue:l.form.isExclusive,"onUpdate:modelValue":e[3]||(e[3]=f=>l.form.isExclusive=f)},null,8,["modelValue"]),e[8]||(e[8]=i("div",{class:"g-tip"},"（注:开启后，同一个企业的客户会优先添加到同一个跟进人）",-1))]),_:1}),t(c,{label:"二维码logo",prop:"logoUrl"},{default:o(()=>[t(m,{fileUrl:l.form.logoUrl,"onUpdate:fileUrl":e[4]||(e[4]=f=>l.form.logoUrl=f),"on-remove":r.handleRemove},{tip:o(()=>[...e[9]||(e[9]=[i("div",null,"图片大小不超过2M",-1)])]),_:1},8,["fileUrl","on-remove"])]),_:1})],64)),t(c,{label:"新客标签",error:l.tagErrorTip},{default:o(()=>[t(L,{modelValue:l.form.tags,"onUpdate:modelValue":e[5]||(e[5]=f=>l.form.tags=f),"value-key":"id",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,placeholder:"请选择"},{default:o(()=>[(g(!0),b(v,null,N(l.tagList,f=>(g(),y(V,{key:f.id,label:f.name,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["error"]),t(c,{label:"自动备注"},{default:o(()=>[t(L,{modelValue:l.form.remarkType,"onUpdate:modelValue":e[6]||(e[6]=f=>l.form.remarkType=f),"value-key":"id",placeholder:"请选择"},{default:o(()=>[(g(!0),b(v,null,N(l.remarkList,f=>(g(),y(V,{key:f.key,label:f.val,value:f.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[10]||(e[10]=i("div",{class:"g-tip"}," （注:选择后，添加的客户会根据所选自动备注如：【客户名-渠道名】,如果选择为标签类型,则新客标签需要存在） ",-1))]),_:1}),t(I,{data:n.j,ref:"WelcomeForm"},null,8,["data"])]),_:1},8,["rules","model"])])}const Ve=ne(be,[["render",ke]]);let{getList:j,del:G,distributeUserCode:Y,findUserCodeKvs:H,countTotalTab:X,countTrend:Z,synchShortLink:$,synchUserCode:ee,synchUserCodeByConfigIds:le,synchShortLinkByLinkIds:te,getShortLinkConfigIds:se,getUserCodeConfigIds:oe,getCustomerList:Le}={};const Ne={data(){let r=location.href.includes("customerLink");return{getList:j,del:G,distributeUserCode:Y,findUserCodeKvs:H,countTotalTab:X,countTrend:Z,synchShortLink:$,synchUserCode:ee,synchUserCodeByConfigIds:le,synchShortLinkByLinkIds:te,getShortLinkConfigIds:se,getUserCodeConfigIds:oe,getCustomerList:Le}=r?ie:re,{activeName:"first",query:{page:1,size:10},list:"",total:0,multipleSelection:[],loading:!1,dialogVisible:!1,form:{},queryParm:{codeId:null,time:null},options:[],xData:[],series:[],tabCount:{},searchQuery:{codeName:"",userName:"",dateRange:null},userCodeSearchQuery:{codeName:"",userName:"",dateRange:null},userList:[],customerDialogVisible:!1,customerList:[],customerLoading:!1,currentLinkInfo:null,customerSearchQuery:{customerName:"",followUser:"",dateRange:null},customerPagination:{cursor:"",hasNext:!1,hasPrev:!1,prevCursors:[]},syncDialogVisible:!1,syncForm:{syncType:"full",specificIds:""},syncLoading:!1,configIdOptions:[],manualIds:"",isInput:!1,isLink:r}},components:{aev:Ve},watch:{},created(){this.getList(),this.getData(),this.initSelect(),this.selectCount()},mounted(){this.getUserListData()},methods:{getList(r){r&&(this.query.page=r),this.$store.loading=!0;let e={...this.query};this.isLink?(this.searchQuery.codeName&&(e.codeName=this.searchQuery.codeName),this.searchQuery.userName&&(e.userName=this.searchQuery.userName),this.searchQuery.dateRange&&this.searchQuery.dateRange.length===2&&(e.beginTime=this.formatDate(this.searchQuery.dateRange[0]),e.endTime=this.formatDate(this.searchQuery.dateRange[1]))):(this.userCodeSearchQuery.codeName&&(e.codeName=this.userCodeSearchQuery.codeName),this.userCodeSearchQuery.userName&&(e.userName=this.userCodeSearchQuery.userName),this.userCodeSearchQuery.dateRange&&this.userCodeSearchQuery.dateRange.length===2&&(e.beginTime=this.formatDate(this.userCodeSearchQuery.dateRange[0]),e.endTime=this.formatDate(this.userCodeSearchQuery.dateRange[1]))),j(e).then(({data:a,count:d})=>{this.list=a,this.total=+d,this.multipleSelection=[]}).catch(a=>console.error(a)).finally(()=>this.$store.loading=!1)},initSelect(){H().then(r=>{this.options=r.data,console.log(r)}).catch(r=>console.error(r))},del(r){var a,d;let e=r||((d=(a=this.multipleSelection)==null?void 0:a.join)==null?void 0:d.call(a,","));if(!e)return this.msgError("请选择需要删除的数据");this.$confirm().then(()=>(this.$store.loading=!0,G(e).then(l=>{this.msgSuccess("删除成功"),this.getList()}))).catch(l=>{console.error(l)}).finally(()=>this.$store.loading=!1)},distributeUserCode(r){this.$confirm("是否将当前活码下发给员工, 是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{Y(r).then(e=>{this.msgSuccess("已通知")})}).catch(e=>{console.error(e)})},downloadBlob(r,e){!r.startsWith("http")&&!r.startsWith("https")&&(r=fe.BASE_API+"/file/fileView/"+r);const a=document.createElement("a");a.href=r,a.download=e,a.click()},submit(){this.loading=!0,this.$refs.aev.submit().then(()=>{this.dialogVisible=!1,this.getList(),this.initSelect()}).catch(r=>console.error(r)).finally(()=>this.loading=!1)},getData(){var e,a;var r={userCodeId:this.queryParm.codeId,startTime:this.queryParm.time===null?null:this.formatDate((e=this.queryParm.time)==null?void 0:e[0]),endTime:this.queryParm.time===null?null:this.formatDate((a=this.queryParm.time)==null?void 0:a[1])};this.selectCount(r)},restting(){this.queryParm.codeId=null,this.queryParm.time=null,this.getData()},selectCount(r){X(r).then(({data:e})=>{this.tabCount=e}).catch(e=>console.error(e)),Z(r).then(({data:e})=>{this.xData=e.xdata,this.series=e.series,console.log(e)}).catch(e=>console.error(e))},formatDate(r){const e=r.getFullYear(),a=(r.getMonth()+1).toString().padStart(2,"0"),d=r.getDate().toString().padStart(2,"0");return`${e}-${a}-${d}`},synchShortLink(){this.openSyncDialog()},synchUserCode(){this.openSyncDialog()},openSyncDialog(){this.syncForm={syncType:"full",specificIds:""},this.configIdOptions=[],this.manualIds="",this.syncDialogVisible=!0,this.loadConfigIds()},loadConfigIds(){(this.isLink?se:oe)().then(e=>{e.code===200&&e.data?this.configIdOptions=e.data:this.msgError("获取配置ID列表失败")}).catch(e=>{console.error("获取配置ID列表失败:",e),this.msgError("获取配置ID列表失败，请重试")})},handleConfigIdChange(r){this.isInput||(this.manualIds="")},handleManualInput(r){this.isInput=!0,this.syncForm.specificIds=[],this.$nextTick(()=>{})},performSync(){if(this.syncForm.syncType==="specific"&&!(this.syncForm.specificIds+""||this.manualIds).trim()){this.msgError("请选择或输入要同步的ID");return}this.syncLoading=!0;let r;if(this.syncForm.syncType==="full")this.isLink?r=$():r=ee();else{const e=(this.syncForm.specificIds+""||this.manualIds).trim();this.isLink?r=te(e):r=le(e)}r.then(e=>{this.msgSuccess(e.msg||"同步任务已启动，请稍后查看"),this.syncDialogVisible=!1,this.getList()}).catch(e=>{console.error(e),this.msgError("同步失败，请重试")}).finally(()=>{this.syncLoading=!1})},searchList(){this.query.page=1,this.getList()},resetSearch(){this.searchQuery={codeName:"",userName:"",dateRange:null},this.query.page=1,this.getList()},searchUserCodeList(){this.query.page=1,this.getList()},resetUserCodeSearch(){this.userCodeSearchQuery={codeName:"",userName:"",dateRange:null},this.query.page=1,this.getList()},getUserListData(){ae().then(r=>{r.code==200&&(this.userList=r.data||[])}).catch(r=>{console.error("获取员工列表失败:",r)})},viewCustomers(r){this.currentLinkInfo=r,this.customerDialogVisible=!0,this.resetCustomerPagination(),this.loadCustomers()},loadCustomers(r=""){if(!this.currentLinkInfo||!this.currentLinkInfo.configId){this.msgError("获客链接配置ID不存在");return}this.customerLoading=!0;const e={};this.customerSearchQuery.customerName&&(e.customerName=this.customerSearchQuery.customerName),this.customerSearchQuery.followUser&&(e.followUser=this.customerSearchQuery.followUser),this.customerSearchQuery.dateRange&&this.customerSearchQuery.dateRange.length===2&&(e.startDate=this.formatDate(this.customerSearchQuery.dateRange[0]),e.endDate=this.formatDate(this.customerSearchQuery.dateRange[1])),ge(this.currentLinkInfo.configId,100,r,e).then(a=>{if(a.code===200&&a.data){const d=a.data;this.customerList=d.customerList||[],this.customerPagination.cursor=d.nextCursor||"",this.customerPagination.hasNext=!!d.nextCursor,this.customerPagination.hasPrev=this.customerPagination.prevCursors.length>0,console.log("客户列表数据:",d),console.log("客户列表详细结构:",JSON.stringify(d,null,2))}else this.msgError(a.msg||"获取客户列表失败"),this.customerList=[]}).catch(a=>{console.error("获取客户列表失败:",a),this.msgError("获取客户列表失败，请重试"),this.customerList=[]}).finally(()=>{this.customerLoading=!1})},loadNextCustomers(){this.customerPagination.hasNext&&this.customerPagination.cursor&&(this.customerPagination.prevCursors.push(this.customerPagination.cursor),this.loadCustomers(this.customerPagination.cursor))},loadPrevCustomers(){if(this.customerPagination.hasPrev&&this.customerPagination.prevCursors.length>0){this.customerPagination.prevCursors.pop();const r=this.customerPagination.prevCursors.length>0?this.customerPagination.prevCursors[this.customerPagination.prevCursors.length-1]:"";this.loadCustomers(r)}},resetCustomerPagination(){this.customerPagination={cursor:"",hasNext:!1,hasPrev:!1,prevCursors:[]}},searchCustomers(){this.resetCustomerPagination(),this.loadCustomers()},resetCustomerSearch(){this.customerSearchQuery={customerName:"",followUser:"",dateRange:null},this.searchCustomers()},getChatStatusText(r){return{0:"未开口",1:"已开口",2:"已删除"}[r]||"未知"},getChatStatusType(r){return{0:"info",1:"success",2:"danger"}[r]||"info"},formatDate(r){if(!r)return"";const e=new Date(r),a=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${a}-${d}-${l}`}}},Se={class:"g-card"},Ie={class:"fxbw"},xe={class:"g-card"},Ue={class:"g-card"},we={class:"g-card"},_e={class:"fxbw"},De={class:"g-card"},Pe={class:"g-card"},Qe={class:"form-tip"},Te={class:"form-tip"},qe={class:"customer-dialog-content"},Fe={class:"pagination-container",style:{"text-align":"center","margin-top":"20px"}},Re={style:{margin:"0 20px"}};function Ee(r,e,a,d,l,n){const w=p("el-input"),c=p("el-form-item"),V=p("el-option"),L=p("el-select"),S=p("el-date-picker"),m=p("el-button"),I=p("el-form"),h=p("el-table-column"),f=p("TagEllipsis"),T=p("el-table"),R=p("pagination"),P=p("el-tab-pane"),C=p("el-statistic"),x=p("el-col"),E=p("el-row"),M=p("ChartLine"),B=p("el-tabs"),ue=p("aev"),q=p("el-dialog"),O=p("el-radio"),de=p("el-radio-group"),me=p("el-divider"),pe=p("el-tag"),Q=ce("loading");return g(),b("div",null,[l.isLink?(g(),y(B,{key:0,modelValue:l.activeName,"onUpdate:modelValue":e[12]||(e[12]=s=>l.activeName=s)},{default:o(()=>[t(P,{label:"外链配置",name:"first"},{default:o(()=>[i("div",Se,[t(I,{class:"searchForm",ref:"searchForm",model:l.searchQuery,"label-width":"",inline:""},{default:o(()=>[t(c,{label:"外链名称:"},{default:o(()=>[t(w,{modelValue:l.searchQuery.codeName,"onUpdate:modelValue":e[0]||(e[0]=s=>l.searchQuery.codeName=s),placeholder:"请输入外链名称",clearable:"",style:{width:"200px"},onKeyup:F(n.searchList,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(c,{label:"员工名称:"},{default:o(()=>[t(L,{modelValue:l.searchQuery.userName,"onUpdate:modelValue":e[1]||(e[1]=s=>l.searchQuery.userName=s),placeholder:"请选择员工",clearable:"",filterable:"",style:{width:"200px"},onChange:n.searchList},{default:o(()=>[(g(!0),b(v,null,N(l.userList,s=>(g(),y(V,{key:s.userId,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t(c,{label:"创建时间:"},{default:o(()=>[t(S,{modelValue:l.searchQuery.dateRange,"onUpdate:modelValue":e[2]||(e[2]=s=>l.searchQuery.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"},onChange:n.searchList},null,8,["modelValue","onChange"])]),_:1}),t(c,null,{default:o(()=>[t(m,{type:"primary",onClick:n.searchList},{default:o(()=>[...e[39]||(e[39]=[u("查询",-1)])]),_:1},8,["onClick"]),t(m,{onClick:n.resetSearch},{default:o(()=>[...e[40]||(e[40]=[u("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),i("div",Ie,[i("div",null,[t(m,{type:"primary",onClick:e[3]||(e[3]=s=>{l.form={},l.dialogVisible=!0})},{default:o(()=>[...e[41]||(e[41]=[u("新建",-1)])]),_:1}),t(m,{type:"primary",onClick:e[4]||(e[4]=s=>n.synchShortLink())},{default:o(()=>[...e[42]||(e[42]=[u("同步外链",-1)])]),_:1})]),t(m,{disabled:!l.multipleSelection.length,onClick:e[5]||(e[5]=s=>n.del()),type:"danger"},{default:o(()=>[...e[43]||(e[43]=[u("批量删除",-1)])]),_:1},8,["disabled"])]),t(T,{data:l.list,"tooltip-effect":"dark","highlight-current-row":"",onSelectionChange:e[6]||(e[6]=s=>l.multipleSelection=s.map(k=>k.id))},{default:o(()=>[t(h,{type:"selection",width:"50",align:"center"}),t(h,{label:"名称",prop:"codeName","show-overflow-tooltip":""}),t(h,{label:"地址",prop:"codeUrl"}),t(h,{label:"使用员工"},{default:o(({row:s})=>[t(f,{list:s.userName},null,8,["list"])]),_:1}),t(h,{label:"标签"},{default:o(({row:s})=>[t(f,{list:s.tagName},null,8,["list"])]),_:1}),t(h,{label:"更新时间",prop:"updateTime"}),t(h,{label:"操作",fixed:"right",width:"280"},{default:o(({row:s})=>[t(m,{text:"",onClick:k=>{l.form=JSON.parse(JSON.stringify(s)),l.dialogVisible=!0}},{default:o(()=>[...e[44]||(e[44]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(m,{text:"",onClick:k=>n.del(s.id)},{default:o(()=>[...e[45]||(e[45]=[u("删除",-1)])]),_:1},8,["onClick"]),l.isLink?U("",!0):(g(),b(v,{key:0},[t(m,{text:"",onClick:k=>n.distributeUserCode(s.id)},{default:o(()=>[...e[46]||(e[46]=[u("通知",-1)])]),_:1},8,["onClick"]),t(m,{text:"",onClick:k=>n.downloadBlob(s.codeUrl,s.codeName)},{default:o(()=>[...e[47]||(e[47]=[u("活码下载",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),_(t(R,{total:l.total,page:l.query.page,"onUpdate:page":e[7]||(e[7]=s=>l.query.page=s),limit:l.query.size,"onUpdate:limit":e[8]||(e[8]=s=>l.query.size=s),onPagination:e[9]||(e[9]=s=>n.getList())},null,8,["total","page","limit"]),[[A,l.total>0]])])]),_:1}),t(P,{label:"外链统计",name:"second"},{default:o(()=>[t(I,{class:"searchForm",ref:"searchForm",model:r.query2,"label-width":"",inline:""},{default:o(()=>[t(c,{label:"渠道名称:",prop:"value3"},{default:o(()=>[t(L,{modelValue:l.queryParm.codeId,"onUpdate:modelValue":e[10]||(e[10]=s=>l.queryParm.codeId=s),"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,placeholder:"全部",style:{width:"260px"}},{default:o(()=>[(g(!0),b(v,null,N(l.options,s=>(g(),y(V,{key:s.val,label:s.key,value:s.val},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"时间:"},{default:o(()=>[t(S,{modelValue:l.queryParm.time,"onUpdate:modelValue":e[11]||(e[11]=s=>l.queryParm.time=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(m,{type:"primary",onClick:n.getData},{default:o(()=>[...e[48]||(e[48]=[u("查询",-1)])]),_:1},8,["onClick"]),t(m,{onClick:n.restting},{default:o(()=>[...e[49]||(e[49]=[u("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),i("div",xe,[t(E,{gutter:20},{default:o(()=>[t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{"value-style":"font-size:20px;",title:"新增客户总数",value:l.tabCount.addCustomerNumber},null,8,["value"])]),e[50]||(e[50]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日新增客户数",value:l.tabCount.tdAddCustomerNumber},null,8,["value"])])]),_:1}),t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{title:"流失客户总数",value:l.tabCount.lostCustomerNumber},null,8,["value"])]),e[51]||(e[51]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日流失客户数",value:l.tabCount.tdLostCustomerNumber},null,8,["value"])])]),_:1}),t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{title:"员工删除客户总数",value:l.tabCount.delCustomerNumber},null,8,["value"])]),e[52]||(e[52]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日员工删除客户数",value:l.tabCount.tddelCustomerNumber},null,8,["value"])])]),_:1}),t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{title:"净增客户总数",value:l.tabCount.netGrowthCustomerNumber},null,8,["value"])]),e[53]||(e[53]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日净增客户数",value:l.tabCount.tdNetGrowthCustomerNumber},null,8,["value"])])]),_:1})]),_:1})]),i("div",Ue,[t(M,{xData:l.xData,legend:["新增客户数","流失客户数","员工删除客户数","净增客户数"],series:l.series},null,8,["xData","series"])])]),_:1})]),_:1},8,["modelValue"])):U("",!0),l.isLink?U("",!0):(g(),y(B,{key:1,modelValue:l.activeName,"onUpdate:modelValue":e[25]||(e[25]=s=>l.activeName=s)},{default:o(()=>[t(P,{label:"员工活码配置",name:"first"},{default:o(()=>[i("div",we,[t(I,{class:"searchForm",ref:"userCodeSearchForm",model:l.userCodeSearchQuery,"label-width":"",inline:""},{default:o(()=>[t(c,{label:"活码名称:"},{default:o(()=>[t(w,{modelValue:l.userCodeSearchQuery.codeName,"onUpdate:modelValue":e[13]||(e[13]=s=>l.userCodeSearchQuery.codeName=s),placeholder:"请输入活码名称",clearable:"",style:{width:"200px"},onKeyup:F(n.searchUserCodeList,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(c,{label:"员工名称:"},{default:o(()=>[t(L,{modelValue:l.userCodeSearchQuery.userName,"onUpdate:modelValue":e[14]||(e[14]=s=>l.userCodeSearchQuery.userName=s),placeholder:"请选择员工",clearable:"",filterable:"",style:{width:"200px"},onChange:n.searchUserCodeList},{default:o(()=>[(g(!0),b(v,null,N(l.userList,s=>(g(),y(V,{key:s.userId,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t(c,{label:"创建时间:"},{default:o(()=>[t(S,{modelValue:l.userCodeSearchQuery.dateRange,"onUpdate:modelValue":e[15]||(e[15]=s=>l.userCodeSearchQuery.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"},onChange:n.searchUserCodeList},null,8,["modelValue","onChange"])]),_:1}),t(c,null,{default:o(()=>[t(m,{type:"primary",onClick:n.searchUserCodeList},{default:o(()=>[...e[54]||(e[54]=[u("查询",-1)])]),_:1},8,["onClick"]),t(m,{onClick:n.resetUserCodeSearch},{default:o(()=>[...e[55]||(e[55]=[u("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),i("div",_e,[i("div",null,[t(m,{type:"primary",onClick:e[16]||(e[16]=s=>{l.form={},l.dialogVisible=!0})},{default:o(()=>[...e[56]||(e[56]=[u("新建",-1)])]),_:1}),t(m,{type:"primary",onClick:e[17]||(e[17]=s=>n.synchUserCode())},{default:o(()=>[...e[57]||(e[57]=[u("同步活码",-1)])]),_:1})]),t(m,{disabled:!l.multipleSelection.length,onClick:e[18]||(e[18]=s=>n.del()),type:"danger"},{default:o(()=>[...e[58]||(e[58]=[u("批量删除",-1)])]),_:1},8,["disabled"])]),t(T,{data:l.list,"tooltip-effect":"dark","highlight-current-row":"",onSelectionChange:e[19]||(e[19]=s=>l.multipleSelection=s.map(k=>k.id))},{default:o(()=>[t(h,{type:"selection",width:"50",align:"center"}),t(h,{label:"活码名称",prop:"codeName","show-overflow-tooltip":""}),t(h,{label:"活码地址",prop:"codeUrl"}),t(h,{label:"使用员工"},{default:o(({row:s})=>[t(f,{list:s.userName},null,8,["list"])]),_:1}),t(h,{label:"标签"},{default:o(({row:s})=>[t(f,{list:s.tagName},null,8,["list"])]),_:1}),t(h,{label:"更新时间",prop:"updateTime"}),t(h,{label:"操作",fixed:"right"},{default:o(({row:s})=>[t(m,{text:"",onClick:k=>{l.form=JSON.parse(JSON.stringify(s)),l.dialogVisible=!0}},{default:o(()=>[...e[59]||(e[59]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(m,{text:"",onClick:k=>n.del(s.id)},{default:o(()=>[...e[60]||(e[60]=[u("删除",-1)])]),_:1},8,["onClick"]),l.isLink?U("",!0):(g(),b(v,{key:0},[t(m,{text:"",onClick:k=>n.distributeUserCode(s.id)},{default:o(()=>[...e[61]||(e[61]=[u("通知",-1)])]),_:1},8,["onClick"]),t(m,{text:"",onClick:k=>n.downloadBlob(s.codeUrl,s.codeName)},{default:o(()=>[...e[62]||(e[62]=[u("活码下载",-1)])]),_:1},8,["onClick"])],64))]),_:1})]),_:1},8,["data"]),_(t(R,{total:l.total,page:l.query.page,"onUpdate:page":e[20]||(e[20]=s=>l.query.page=s),limit:l.query.size,"onUpdate:limit":e[21]||(e[21]=s=>l.query.size=s),onPagination:e[22]||(e[22]=s=>n.getList())},null,8,["total","page","limit"]),[[A,l.total>0]])])]),_:1}),t(P,{label:"员工活码统计",name:"second"},{default:o(()=>[t(I,{class:"searchForm",ref:"searchForm",model:r.query2,"label-width":"",inline:""},{default:o(()=>[t(c,{label:"渠道名称:",prop:"value3"},{default:o(()=>[t(L,{modelValue:l.queryParm.codeId,"onUpdate:modelValue":e[23]||(e[23]=s=>l.queryParm.codeId=s),"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,placeholder:"全部",style:{width:"260px"}},{default:o(()=>[(g(!0),b(v,null,N(l.options,s=>(g(),y(V,{key:s.val,label:s.key,value:s.val},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"时间:"},{default:o(()=>[t(S,{modelValue:l.queryParm.time,"onUpdate:modelValue":e[24]||(e[24]=s=>l.queryParm.time=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(m,{type:"primary",onClick:n.getData},{default:o(()=>[...e[63]||(e[63]=[u("查询",-1)])]),_:1},8,["onClick"]),t(m,{onClick:n.restting},{default:o(()=>[...e[64]||(e[64]=[u("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),i("div",De,[t(E,{gutter:20},{default:o(()=>[t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{"value-style":"font-size:20px;",title:"新增客户总数",value:l.tabCount.addCustomerNumber},null,8,["value"])]),e[65]||(e[65]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日新增客户数",value:l.tabCount.tdAddCustomerNumber},null,8,["value"])])]),_:1}),t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{title:"流失客户总数",value:l.tabCount.lostCustomerNumber},null,8,["value"])]),e[66]||(e[66]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日流失客户数",value:l.tabCount.tdLostCustomerNumber},null,8,["value"])])]),_:1}),t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{title:"员工删除客户总数",value:l.tabCount.delCustomerNumber},null,8,["value"])]),e[67]||(e[67]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日员工删除客户数",value:l.tabCount.tddelCustomerNumber},null,8,["value"])])]),_:1}),t(x,{span:6},{default:o(()=>[i("div",null,[t(C,{title:"净增客户总数",value:l.tabCount.netGrowthCustomerNumber},null,8,["value"])]),e[68]||(e[68]=i("br",null,null,-1)),i("div",null,[t(C,{title:"今日净增客户数",value:l.tabCount.tdNetGrowthCustomerNumber},null,8,["value"])])]),_:1})]),_:1})]),i("div",Pe,[t(M,{xData:l.xData,legend:["新增客户数","流失客户数","员工删除客户数","净增客户数"],series:l.series},null,8,["xData","series"])])]),_:1})]),_:1},8,["modelValue"])),t(q,{title:l.form.id?"编辑":"新建",modelValue:l.dialogVisible,"onUpdate:modelValue":e[27]||(e[27]=s=>l.dialogVisible=s),width:"80%","close-on-click-modal":!1},{footer:o(()=>[t(m,{onClick:e[26]||(e[26]=s=>l.dialogVisible=!1)},{default:o(()=>[...e[69]||(e[69]=[u("取消",-1)])]),_:1}),_((g(),y(m,{type:"primary",onClick:n.submit},{default:o(()=>[...e[70]||(e[70]=[u("确定",-1)])]),_:1},8,["onClick"])),[[Q,l.loading]])]),default:o(()=>[l.dialogVisible?(g(),y(ue,{key:0,data:l.form,ref:"aev"},null,8,["data"])):U("",!0)]),_:1},8,["title","modelValue"]),t(q,{title:l.isLink?"同步获客外链":"同步员工活码",modelValue:l.syncDialogVisible,"onUpdate:modelValue":e[33]||(e[33]=s=>l.syncDialogVisible=s),width:"500px","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[t(m,{onClick:e[32]||(e[32]=s=>l.syncDialogVisible=!1)},{default:o(()=>[...e[74]||(e[74]=[u("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:n.performSync,loading:l.syncLoading},{default:o(()=>[u(D(l.syncForm.syncType==="full"?"开始同步":"指定同步"),1)]),_:1},8,["onClick","loading"])]),default:o(()=>[t(I,{model:l.syncForm,"label-width":"100px"},{default:o(()=>[t(c,{label:"同步模式:"},{default:o(()=>[t(de,{modelValue:l.syncForm.syncType,"onUpdate:modelValue":e[28]||(e[28]=s=>l.syncForm.syncType=s)},{default:o(()=>[t(O,{label:"full"},{default:o(()=>[...e[71]||(e[71]=[u("常规同步（全量同步）",-1)])]),_:1}),t(O,{label:"specific"},{default:o(()=>[...e[72]||(e[72]=[u("指定同步（单条同步）",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l.syncForm.syncType==="specific"?(g(),y(c,{key:0,label:l.isLink?"获客外链ID:":"配置ID:",required:""},{default:o(()=>[t(L,{modelValue:l.syncForm.specificIds,"onUpdate:modelValue":e[29]||(e[29]=s=>l.syncForm.specificIds=s),placeholder:l.isLink?"请选择要同步的获客外链":"请选择要同步的员工活码",multiple:"",filterable:"",clearable:"",style:{width:"100%"},onChange:n.handleConfigIdChange},{default:o(()=>[(g(!0),b(v,null,N(l.configIdOptions,s=>(g(),y(V,{key:s.val,label:s.key,value:s.val},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","onChange"]),i("div",Qe,D(l.isLink?"选择要同步的获客外链，可多选":"选择要同步的员工活码配置，可多选"),1),t(me,{"content-position":"center"},{default:o(()=>[...e[73]||(e[73]=[u("或手动输入",-1)])]),_:1}),t(w,{modelValue:l.manualIds,"onUpdate:modelValue":e[30]||(e[30]=s=>l.manualIds=s),placeholder:l.isLink?"手动输入获客外链ID，多个用逗号分隔":"手动输入员工活码配置ID，多个用逗号分隔",clearable:"",onInput:n.handleManualInput,onBlur:e[31]||(e[31]=s=>l.isInput=!1)},null,8,["modelValue","placeholder","onInput"]),i("div",Te,D(l.isLink?"手动输入获客外链ID，多个ID用英文逗号分隔":"手动输入员工活码配置ID，多个ID用英文逗号分隔"),1)]),_:1},8,["label"])):U("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(q,{title:"客户列表",modelValue:l.customerDialogVisible,"onUpdate:modelValue":e[38]||(e[38]=s=>l.customerDialogVisible=s),width:"80%","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[t(m,{onClick:e[37]||(e[37]=s=>l.customerDialogVisible=!1)},{default:o(()=>[...e[79]||(e[79]=[u("关闭",-1)])]),_:1})]),default:o(()=>[i("div",qe,[t(I,{class:"searchForm",model:l.customerSearchQuery,"label-width":"",inline:""},{default:o(()=>[t(c,{label:"客户姓名:"},{default:o(()=>[t(w,{modelValue:l.customerSearchQuery.customerName,"onUpdate:modelValue":e[34]||(e[34]=s=>l.customerSearchQuery.customerName=s),placeholder:"请输入客户姓名",clearable:"",style:{width:"200px"},onKeyup:F(n.searchCustomers,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(c,{label:"跟进人:"},{default:o(()=>[t(L,{modelValue:l.customerSearchQuery.followUser,"onUpdate:modelValue":e[35]||(e[35]=s=>l.customerSearchQuery.followUser=s),placeholder:"请选择跟进人",clearable:"",filterable:"",style:{width:"200px"},onChange:n.searchCustomers},{default:o(()=>[(g(!0),b(v,null,N(l.userList,s=>(g(),y(V,{key:s.userId,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t(c,{label:"添加时间:"},{default:o(()=>[t(S,{modelValue:l.customerSearchQuery.dateRange,"onUpdate:modelValue":e[36]||(e[36]=s=>l.customerSearchQuery.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(m,{type:"primary",onClick:n.searchCustomers},{default:o(()=>[...e[75]||(e[75]=[u("查询",-1)])]),_:1},8,["onClick"]),t(m,{onClick:n.resetCustomerSearch},{default:o(()=>[...e[76]||(e[76]=[u("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),_((g(),y(T,{data:l.customerList,"tooltip-effect":"dark",style:{width:"100%"}},{default:o(()=>[t(h,{prop:"externalName",label:"客户姓名",width:"150","show-overflow-tooltip":""}),t(h,{prop:"followUserName",label:"跟进人",width:"120"}),t(h,{prop:"createTime",label:"添加时间",width:"180"}),t(h,{prop:"chatStatus",label:"会话状态",width:"100"},{default:o(({row:s})=>[t(pe,{type:n.getChatStatusType(s.chatStatus)},{default:o(()=>[u(D(n.getChatStatusText(s.chatStatus)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[Q,l.customerLoading]]),i("div",Fe,[_((g(),y(m,{disabled:!l.customerPagination.hasPrev,onClick:n.loadPrevCustomers},{default:o(()=>[...e[77]||(e[77]=[u(" 上一页 ",-1)])]),_:1},8,["disabled","onClick"])),[[Q,l.customerLoading]]),i("span",Re,"共 "+D(l.customerList.length)+" 条记录",1),_((g(),y(m,{disabled:!l.customerPagination.hasNext,onClick:n.loadNextCustomers},{default:o(()=>[...e[78]||(e[78]=[u(" 下一页 ",-1)])]),_:1},8,["disabled","onClick"])),[[Q,l.customerLoading]])])])]),_:1},8,["modelValue"])])}const Ke=ne(Ne,[["render",Ee],["__scopeId","data-v-83a6d6b6"]]);export{Ke as default};
