import{H as J,s as h,r as n,o as i,d as k,e as o,j as t,C as u,D as v,_ as L,c as U,k as m,F as q,f as _,h as z,t as Q,Q as K}from"../index-DYxDfolO.js";import W from"./index-BZfwh3-u.js";import"./TagEllipsis-CcQ_ZfLe.js";/* empty css                                                                    */const{get:G,post:X,put:ue,delt:de}=J,I="/groupMsg",Y=c=>G(`${I}/findGroupMsgPage`,c),Z=c=>G(`${I}/findGroupMsgById/${c}`),ee=c=>X(`${I}/buildGroupMsg`,c),te=h({__name:"SelectCustomer",emits:["confirm"],setup(c,{expose:B,emit:b}){const V=v(),R=v([]),D=b;return B({dialogRef:V}),($,p)=>{const w=n("BaDialog");return i(),k(w,{ref_key:"dialogRef",ref:V,title:"选择客户","append-to-body":"",width:"900",onConfirm:p[1]||(p[1]=({visible:l,loading:e})=>D("confirm",{visible:l,loading:e,selected:u(R)}))},{default:o(()=>[t(W,{isSelect:"",onSelectionChange:p[0]||(p[0]=l=>R.value=l)})]),_:1},512)}}}),le=L(te,[["__scopeId","data-v-9ac34cb6"]]),oe=["_"],ae=h({__name:"list",setup(c){const B={1:"立即发送",2:"定时发送"};let b=v(location.href.includes("customer")?"single":"group");const V=v({}),R=v();async function D({form:l,visible:e,loading:f}){var T;l=JSON.parse(JSON.stringify(l.value)),l.chatType=b.value,l.periodAnnexLists=[];let r=(T=l.annexLists)==null?void 0:T.map(async(d,C)=>{let M=await V.value.contentFormRef[C].submit();return M?(d[d.msgtype]=Object.assign(d[d.msgtype]||{},M),!0):!1});r&&await Promise.all(r),ee(l).then(d=>{$sdk.msgSuccess(),R.value.getList()}).finally(d=>{e.value=!1,f.value=!1})}const $=v(),p=K(()=>{var l,e;return(e=(l=$.value)==null?void 0:l.form)==null?void 0:e.id});function w(l){Z(l.id).then(({data:e})=>{var f;e.sendType=(f=e.sendType)==null?void 0:f.toString(),l=e,$.value.action(l)})}return(l,e)=>{const f=n("el-input"),r=n("el-form-item"),T=n("el-button"),d=n("el-radio"),C=n("el-radio-group"),M=n("TagEllipsis"),F=n("SelectGroup"),P=n("el-date-picker"),A=n("TextareaExtend"),E=n("addAttachment"),H=n("BaDialog"),N=n("el-table-column"),O=n("TableOperateBtn"),j=n("RequestChartTable");return i(),U("div",{_:l.$store.setBusininessDesc("<div>通过企业微信群发工具触达客户</div>")},[t(j,{ref_key:"rctRef",ref:R,request:u(Y),params:{chatType:u(b)},searchBtnType:"icon"},{query:o(({query:S})=>[t(r,{label:"群发内容",prop:"groupMsgName"},{default:o(()=>[t(f,{modelValue:S.groupMsgName,"onUpdate:modelValue":a=>S.groupMsgName=a,placeholder:"请输入",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),operation:o(({selectedIds:S})=>[t(T,{type:"primary",onClick:e[0]||(e[0]=a=>l.$refs.dialogRef.action())},{default:o(()=>[...e[3]||(e[3]=[m("新建任务",-1)])]),_:1}),t(H,{ref_key:"dialogRef",ref:$,title:"新建任务",width:"1000",isFooter:!u(p),formProps:{"label-width":"auto",disabled:u(p),class:u(p)&&"form-detail"},rules:{scopeType:[l.$sdk.ruleRequiredChange],sendType:[l.$sdk.ruleRequiredChange],complainTime:[l.$sdk.ruleRequiredChange],content:[l.$sdk.ruleRequiredBlur],groupMsgName:[l.$sdk.ruleRequiredBlur]},onConfirm:D},{form:o(({form:a})=>[t(r,{label:"群发任务名",prop:"groupMsgName"},{default:o(()=>[t(f,{modelValue:a.groupMsgName,"onUpdate:modelValue":s=>a.groupMsgName=s,clearable:"",autocomplete:"off",maxlength:"15","show-word-limit":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),u(b)=="group"?(i(),U(q,{key:0},[t(r,{label:"群发客户群",prop:"scopeType"},{default:o(()=>[t(C,{modelValue:a.scopeType,"onUpdate:modelValue":s=>a.scopeType=s},{default:o(()=>[t(d,{label:0},{default:o(()=>[...e[4]||(e[4]=[m("全部群",-1)])]),_:1}),t(d,{label:1},{default:o(()=>[...e[5]||(e[5]=[m("部分群",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a.scopeType==1?(i(),k(r,{key:0,label:"选择客群",prop:"scopeType"},{default:o(()=>[u(p)?_("",!0):(i(),k(T,{key:0,class:"mr10",type:"primary",onClick:e[1]||(e[1]=s=>l.$refs.SelectGroupRef.dialogRef.visible=!0)},{default:o(()=>[...e[6]||(e[6]=[m(" 选择客群 ",-1)])]),_:1})),t(M,{list:a.groupMsgSubList,defaultProps:"acceptName",emptyText:!!u(p)},null,8,["list","emptyText"]),t(F,{ref:"SelectGroupRef",onConfirm:({visible:s,loading:g,selected:x})=>(a.groupMsgSubList=x.map(y=>({acceptId:y.chatId,acceptName:y.chatName,acceptType:"2",senderId:y.owner})),s.value=!1,g.value=!1)},null,8,["onConfirm"])]),_:2},1024)):_("",!0)],64)):_("",!0),u(b)=="single"?(i(),U(q,{key:1},[t(r,{label:"群发客户",prop:"scopeType"},{default:o(()=>[t(C,{modelValue:a.scopeType,"onUpdate:modelValue":s=>a.scopeType=s},{default:o(()=>[t(d,{label:0},{default:o(()=>[...e[7]||(e[7]=[m("全部客户",-1)])]),_:1}),t(d,{label:1},{default:o(()=>[...e[8]||(e[8]=[m("部分客户",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a.scopeType==1?(i(),k(r,{key:0,label:"选择客户",prop:"scopeType"},{default:o(()=>[u(p)?_("",!0):(i(),k(T,{key:0,class:"mr10",type:"primary",onClick:e[2]||(e[2]=s=>l.$refs.SelectCustomerRef.dialogRef.visible=!0)},{default:o(()=>[...e[9]||(e[9]=[m(" 选择客户 ",-1)])]),_:1})),t(M,{list:a.groupMsgSubList,defaultProps:"acceptName",emptyText:!!u(p)},null,8,["list","emptyText"]),t(le,{ref:"SelectCustomerRef",onConfirm:({visible:s,loading:g,selected:x})=>(a.groupMsgSubList=x.map(y=>({acceptId:y.externalUserid,acceptName:y.customerName,acceptType:"1",senderId:y.userId})),s.value=!1,g.value=!1)},null,8,["onConfirm"])]),_:2},1024)):_("",!0)],64)):_("",!0),t(r,{label:"发送类型",prop:"sendType"},{default:o(()=>[t(C,{modelValue:a.sendType,"onUpdate:modelValue":s=>a.sendType=s},{default:o(()=>[(i(),U(q,null,z(B,(s,g)=>t(d,{label:g,disabled:g==2,key:g},{default:o(()=>[m(Q(s),1)]),_:2},1032,["label","disabled"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a.sendType==2?(i(),k(r,{key:2,label:"发送时间",prop:"complainTime"},{default:o(()=>[t(P,{modelValue:a.complainTime,"onUpdate:modelValue":s=>a.complainTime=s,type:"datetime",placeholder:"选择日期时间","picker-options":{disabledDate(s){return s.getTime()<Date.now()}},"default-time":["00:00:00","23:59:59"],format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",clearable:""},null,8,["modelValue","onUpdate:modelValue","picker-options"])]),_:2},1024)):_("",!0),t(r,{label:"群发内容",prop:"content"},{default:o(()=>[t(A,{modelValue:a.content,"onUpdate:modelValue":s=>a.content=s,toolbar:["emoji"],maxlength:"200","show-word-limit":"",placeholder:"请输入",autosize:{minRows:5,maxRows:20},clearable:"",autofocus:!1},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{label:"群发附件",prop:""},{default:o(()=>[t(E,{ref_key:"addAttachmentRef",ref:V,isDetail:u(p),form:a,onRemove:l.remove},null,8,["isDetail","form","onRemove"])]),_:2},1024)]),_:1},8,["isFooter","formProps","rules"])]),table:o(({data:S})=>[t(N,{prop:"groupMsgName",label:"群发任务名"}),t(N,{prop:"content",label:"群发内容"}),t(N,{prop:"updateTime",label:"最近更新时间"}),t(N,{label:"操作",width:"280",fixed:"right"},{default:o(({row:a})=>[t(O,{type:"",onClick:s=>w(a)},{default:o(()=>[...e[10]||(e[10]=[m("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["request","params"])],8,oe)}}}),ie=L(ae,[["__scopeId","data-v-79d97e7d"]]);export{ie as default};
