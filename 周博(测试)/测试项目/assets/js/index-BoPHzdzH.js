import{u as I,a as q,b as T,c as U}from"./api-DFlyeBOG.js";import{d as B}from"./index-CtSVQMOO.js";import{_ as x,c as h,j as l,e as i,r as m,o as p,F as w,h as P,d as V,f as L,i as N,w as k,P as D,a as E,k as c}from"../index-DYxDfolO.js";const J={props:{data:{}},data(){let t=location.href.includes("customerLink");return{rules:{chatCodeName:[{required:!0,message:"请输入活码名称",trigger:"blur"}],users:[{required:!0,message:"请选择",trigger:"change",validator:(e,r,a)=>{r.length==0?a(new Error("请选择")):a()}}],weclomeMsg:[{required:!1,message:"必填项",trigger:"blur"}]},originForm:{beginTime:"",endTime:"",workCycle:[],weclomeMsg:"您好，很高兴为您服务，请问有什么可以帮您？"},form:{chatCodeName:"",chatIds:""},selectedUserList:[],selectedTagList:[],userList:[],groupErrorTip:"",tagList:[],tagErrorTip:"",remarkList:[],annexLists:[],max:9,active:0,dictMsgType:B,isLink:t}},computed:{j(){let{startPeriodAnnex:t,weclomeMsg:e,annexLists:r,periodAnnexLists:a}=this.form;return{startPeriodAnnex:t,weclomeMsg:e,annexLists:r,periodAnnexLists:a}}},watch:{data:{deep:!0,immediate:!0,handler(t){let e=JSON.parse(JSON.stringify(t));e.tags=[],e.users=[],e.tagId&&e.tagName&&(e.tagId=e.tagId.split(","),e.tagName=e.tagName.split(","),e.tagId.forEach((r,a)=>{e.tags.push({id:r,name:e.tagName[a]})})),e.userId&&e.userName&&(e.userId=e.userId.split(","),e.userName=e.userName.split(","),e.userId.forEach((r,a)=>{e.users.push({id:r,name:e.userName[a]})})),this.form=e,setTimeout(()=>{this.$refs.form.clearValidate()},0)}}},created(){this.getGroupList(),this.form.id&&console.log(this.form)},methods:{getGroupList(){T().then(t=>{if(t.code==301){this.groupErrorTip=t.msg;return}this.userList=t.data||[]})},getDetail(t){},async submit(){if(!await this.$refs.form.validate())return;let e=JSON.parse(JSON.stringify(this.form));return console.log(e),(e.id?I:q)(e).then(({data:r})=>{this.msgSuccess("操作成功")}).finally(()=>{this.$store.loading=!1})}}},O={class:""};function M(t,e,r,a,o,f){const d=m("el-input"),u=m("el-form-item"),g=m("el-option"),_=m("el-select"),b=m("el-switch"),v=m("el-input-number"),y=m("el-form");return p(),h("div",O,[l(y,{ref:"form",rules:o.rules,model:o.form,"label-position":"right","label-width":"100px","scroll-into-view-options":!0},{default:i(()=>[l(u,{label:"渠道名称",prop:"chatCodeName"},{default:i(()=>[l(d,{modelValue:o.form.chatCodeName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.chatCodeName=s),maxlength:"15","show-word-limit":"",clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(u,{label:"活码客群:",prop:"chatIds",error:o.groupErrorTip},{default:i(()=>[l(_,{modelValue:o.form.yqueChatList,"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.yqueChatList=s),"value-key":"chatId",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,placeholder:"请选择"},{default:i(()=>[(p(!0),h(w,null,P(o.userList,s=>(p(),V(g,{key:s.chatId,label:s.chatName,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["error"]),l(u,{label:"自动备注"},{default:i(()=>[l(d,{modelValue:o.form.remark,"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.remark=s),maxlength:"30","show-word-limit":"",clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(u,{label:"群满是否自动建群:"},{default:i(()=>[l(b,{modelValue:o.form.autoCreateRoom,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.autoCreateRoom=s),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),o.form.autoCreateRoom?(p(),h(w,{key:0},[l(u,{label:"群名前缀:",prop:"roomBaseName"},{default:i(()=>[l(d,{"show-word-limit":"",maxlength:"20",modelValue:o.form.roomBaseName,"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.roomBaseName=s),placeholder:"请输入群名前缀"},null,8,["modelValue"])]),_:1}),l(u,{label:"群起始序号:",prop:"roomBaseId"},{default:i(()=>[l(v,{modelValue:o.form.roomBaseId,"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.roomBaseId=s),"controls-position":"right",min:1},null,8,["modelValue"])]),_:1})],64)):L("",!0)]),_:1},8,["rules","model"])])}const A=x(J,[["render",M]]);let{getList:F,del:j,distributeUserCode:z,findUserCodeKvs:G,countTotalTab:R,countTrend:W}=U;const K={data(){let t=location.href.includes("customerLink");return{activeName:"first",query:{page:1,size:10},list:"",total:0,multipleSelection:[],loading:!1,dialogVisible:!1,form:{},queryParm:{codeId:null,time:null},options:[],xData:[],series:[],tabCount:{},isLink:t}},components:{aev:A},watch:{},created(){this.getList()},mounted(){},methods:{getList(t){t&&(this.query.page=t),this.$store.loading=!0,F(this.query).then(({data:e,count:r})=>{this.list=e,this.total=+r,this.multipleSelection=[]}).catch(e=>console.error(e)).finally(()=>this.$store.loading=!1)},initSelect(){G().then(t=>{this.options=t.data,console.log(t)}).catch(t=>console.error(t))},del(t){var r,a;let e=t||((a=(r=this.multipleSelection)==null?void 0:r.join)==null?void 0:a.call(r,","));if(!e)return this.msgError("请选择需要删除的数据");this.$confirm().then(()=>(this.$store.loading=!0,j(e).then(o=>{this.msgSuccess("删除成功"),this.getList()}))).catch(o=>{console.error(o)})},distributeUserCode(t){this.$confirm("是否将当前活码下发给员工, 是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{z(t).then(e=>{this.msgSuccess("已通知")})}).catch(e=>{console.error(e)})},downloadBlob(t,e){!t.startsWith("http")&&!t.startsWith("https")&&(t=env.BASE_API+"/file/fileView/"+t);const r=document.createElement("a");r.href=t,r.download=e,r.click()},submit(){this.loading=!0,this.$refs.aev.submit().then(()=>{this.dialogVisible=!1,this.getList()}).catch(t=>console.error(t)).finally(()=>this.loading=!1)},getData(){var e,r;var t={userCodeId:this.queryParm.codeId,startTime:this.queryParm.time===null?null:this.formatDate((e=this.queryParm.time)==null?void 0:e[0]),endTime:this.queryParm.time===null?null:this.formatDate((r=this.queryParm.time)==null?void 0:r[1])};this.selectCount(t)},restting(){this.queryParm.codeId=null,this.queryParm.time=null,this.getData()},selectCount(t){R(t).then(({data:e})=>{this.tabCount=e}).catch(e=>console.error(e)),W(t).then(({data:e})=>{this.xData=e.xdata,this.series=e.series,console.log(e)}).catch(e=>console.error(e))},formatDate(t){const e=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0");return`${e}-${r}-${a}`}}},Y={class:"g-card"},H={class:"fxbw"};function Q(t,e,r,a,o,f){const d=m("el-button"),u=m("el-table-column"),g=m("el-image"),_=m("el-popover"),b=m("el-table"),v=m("pagination"),y=m("aev"),s=m("el-dialog"),S=E("loading");return p(),h("div",null,[N("div",Y,[N("div",H,[l(d,{type:"primary",onClick:e[0]||(e[0]=n=>{o.form={},o.dialogVisible=!0})},{default:i(()=>[...e[8]||(e[8]=[c("新建",-1)])]),_:1}),l(d,{disabled:!o.multipleSelection.length,onClick:e[1]||(e[1]=n=>f.del()),type:"danger"},{default:i(()=>[...e[9]||(e[9]=[c("批量删除",-1)])]),_:1},8,["disabled"])]),l(b,{data:o.list,"tooltip-effect":"dark","highlight-current-row":"",onSelectionChange:e[2]||(e[2]=n=>o.multipleSelection=n.map(C=>C.id))},{default:i(()=>[l(u,{type:"selection",width:"50",align:"center"}),l(u,{label:"活码名称",prop:"chatCodeName","show-overflow-tooltip":""}),l(u,{label:"二维码",prop:"chatCodeUrl"},{default:i(({row:n})=>[l(_,{placement:"bottom",trigger:"hover"},{reference:i(()=>[l(g,{src:n.chatCodeUrl,style:{width:"50px"}},null,8,["src"])]),default:i(()=>[l(g,{src:n.chatCodeUrl,style:{width:"200px"}},null,8,["src"])]),_:2},1024)]),_:1}),l(u,{label:"更新时间",prop:"updateTime"}),l(u,{label:"操作",fixed:"right"},{default:i(({row:n})=>[l(d,{text:"",onClick:C=>{o.form=JSON.parse(JSON.stringify(n)),o.dialogVisible=!0}},{default:i(()=>[...e[10]||(e[10]=[c("编辑",-1)])]),_:1},8,["onClick"]),l(d,{text:"",onClick:C=>f.del(n.id)},{default:i(()=>[...e[11]||(e[11]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),k(l(v,{total:o.total,page:o.query.page,"onUpdate:page":e[3]||(e[3]=n=>o.query.page=n),limit:o.query.size,"onUpdate:limit":e[4]||(e[4]=n=>o.query.size=n),onPagination:e[5]||(e[5]=n=>f.getList())},null,8,["total","page","limit"]),[[D,o.total>0]])]),l(s,{title:o.form.id?"编辑":"新建",modelValue:o.dialogVisible,"onUpdate:modelValue":e[7]||(e[7]=n=>o.dialogVisible=n),width:"80%","close-on-click-modal":!1},{footer:i(()=>[l(d,{onClick:e[6]||(e[6]=n=>o.dialogVisible=!1)},{default:i(()=>[...e[12]||(e[12]=[c("取消",-1)])]),_:1}),k((p(),V(d,{type:"primary",onClick:f.submit},{default:i(()=>[...e[13]||(e[13]=[c("确定",-1)])]),_:1},8,["onClick"])),[[S,o.loading]])]),default:i(()=>[o.dialogVisible?(p(),V(y,{key:0,data:o.form,ref:"aev"},null,8,["data"])):L("",!0)]),_:1},8,["title","modelValue"])])}const ee=x(K,[["render",Q],["__scopeId","data-v-98bfed0e"]]);export{ee as default};
