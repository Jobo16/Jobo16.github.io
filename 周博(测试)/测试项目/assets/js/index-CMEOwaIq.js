const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/HistoryMsg-Ds_CQzKS.js","assets/index-DYxDfolO.js","assets/css/index-DwPq-yKK.css","assets/js/MsgForm-C9cqKKlA.js","assets/css/MsgForm-CPX_6tcj.css"])))=>i.map(i=>d[i]);
import{H as m,_ as B,c as b,w as I,F as O,h as j,i as n,j as i,k as d,e as o,B as k,a as D,r,z as y,o as a,t as S,d as h,f as C}from"../index-DYxDfolO.js";const f="/robot";function E(){return m({url:f+"/findAll"})}function A(l){return m({url:f+`/${l}`,method:"delete"})}function F(l){return m({url:f+"/saveOrUpdate",method:"post",data:l})}const R={getList(l){return m({url:f+"/findRobotSubAll/"+l.robotId,params:l})},add(l){return m({url:f+"/sendRobotMsg",method:"post",data:l})}},z={components:{HistoryMsg:k(()=>y(()=>import("./HistoryMsg-Ds_CQzKS.js"),__vite__mapDeps([0,1,2]))),MsgForm:k(()=>y(()=>import("./MsgForm-C9cqKKlA.js"),__vite__mapDeps([3,1,2,4])))},props:{},data(){return{form:{},list:[],dialogVisible:!1,disabled:!1,loading:!1,rules:Object.freeze({title:[{required:!0,message:"必填项",trigger:"blur"}],webHookUrl:[{required:!0,message:"必填项",trigger:"blur"}]}),formMsg:{},dialogVisibleHistoryMsg:!1,dialogVisibleSendMsg:!1}},watch:{},computed:{},created(){this.getList(),this.$store.setBusininessDesc("<div>通过群机器人给内部群发送消息，通知员工</div> ")},mounted(){},methods:{getList(l){this.loading=!0,E().then(({rows:e,data:V,total:H})=>{this.list=e||V||[]}).finally(()=>{this.loading=!1})},edit(l,e){this.form=Object.assign({},l||{}),this.dialogVisible=!0,e||!l?this.disabled=!1:this.disabled=!0,this.$nextTick(()=>{this.$refs.form.clearValidate()})},submit(){this.$refs.form.validate(l=>{l&&F(this.form).then(()=>{this.msgSuccess("操作成功"),this.dialogVisible=!1,this.getList()}).catch(()=>{this.dialogVisible=!1})})},remove(l){this.$confirm("是否确认删除？该操作不可撤销，请谨慎操作。",{title:"警告",confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return A(l)}).then(()=>{this.getList(),this.msgSuccess("删除成功")})},submitSendMsg(l){l?(l.robotSubList=[{msgType:l.msgType,[l.msgType]:l[l.msgType]}],delete l[l.msgType],delete l.msgType,R.add(l).then(()=>{this.msgSuccess("操作成功"),this.dialogVisibleSendMsg=!1}).catch(()=>{this.dialogVisibleSendMsg=!1})):this.dialogVisibleSendMsg=!1}}},N={class:"list-wrap"},P={class:"list-item"},q={class:"title blod toe"},W={class:"desc mt10"},G={class:"list-action fxbw"},J={class:"ac flex aic cp theme list-item",style:{"justify-content":"center"}};function K(l,e,V,H,s,g){const u=r("el-button"),w=r("el-icon-plus"),_=r("el-input"),M=r("el-form-item"),x=r("el-form"),p=r("el-drawer"),T=r("HistoryMsg"),U=r("MsgForm"),L=D("loading");return a(),b("div",null,[I((a(),b("ul",N,[(a(!0),b(O,null,j(s.list,(t,v)=>(a(),b("li",{key:v,class:"list"},[n("div",P,[n("div",q,S(t.title),1),n("div",W,S(t.webHookUrl),1),n("div",G,[i(u,{text:"",onClick:c=>{s.formMsg={robotId:t.id},l.disabledMsg=!1,s.dialogVisibleSendMsg=!0}},{default:o(()=>[...e[8]||(e[8]=[d(" 发送消息 ",-1)])]),_:1},8,["onClick"]),i(u,{text:"",onClick:c=>{s.formMsg={robotId:t.id},s.dialogVisibleHistoryMsg=!0}},{default:o(()=>[...e[9]||(e[9]=[d(" 历史消息 ",-1)])]),_:1},8,["onClick"]),i(u,{text:"",onClick:c=>g.edit(t)},{default:o(()=>[...e[10]||(e[10]=[d("编辑",-1)])]),_:1},8,["onClick"]),i(u,{text:"",onClick:c=>g.remove(t.id)},{default:o(()=>[...e[11]||(e[11]=[d("删除",-1)])]),_:1},8,["onClick"])])])]))),128)),n("li",{class:"list",onClick:e[0]||(e[0]=t=>g.edit())},[n("div",J,[i(w,{class:"el-icon-plus"}),e[12]||(e[12]=d(" 添加机器人 ",-1))])])])),[[L,s.loading]]),i(p,{title:s.form.id?"编辑":"添加",modelValue:s.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=t=>s.dialogVisible=t),"close-on-click-modal":!1,size:"580px"},{footer:o(()=>[n("div",null,[i(u,{onClick:e[3]||(e[3]=t=>s.dialogVisible=!1)},{default:o(()=>[...e[14]||(e[14]=[d("取 消",-1)])]),_:1}),i(u,{type:"primary",onClick:g.submit},{default:o(()=>[...e[15]||(e[15]=[d("确 定",-1)])]),_:1},8,["onClick"])])]),default:o(()=>[i(x,{ref:"form","label-position":"right",model:s.form,rules:s.rules,"label-width":"90px"},{default:o(()=>[i(M,{label:"群名称",prop:"title"},{default:o(()=>[i(_,{modelValue:s.form.title,"onUpdate:modelValue":e[1]||(e[1]=t=>s.form.title=t),placeholder:"请输入群名称"},null,8,["modelValue"])]),_:1}),i(M,{label:"WebHook",prop:"webHookUrl"},{default:o(()=>[i(_,{modelValue:s.form.webHookUrl,"onUpdate:modelValue":e[2]||(e[2]=t=>s.form.webHookUrl=t),placeholder:"请输入WebHook URL"},null,8,["modelValue"]),e[13]||(e[13]=n("div",{class:"dialog-tip"},"如何获取：企业微信内部群 -> 开启群机器人 -> 复制地址",-1))]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),i(p,{title:"历史消息",modelValue:s.dialogVisibleHistoryMsg,"onUpdate:modelValue":e[6]||(e[6]=t=>s.dialogVisibleHistoryMsg=t),"close-on-click-modal":!1},{default:o(()=>[s.dialogVisibleHistoryMsg?(a(),h(T,{key:0,id:s.formMsg.robotId,ref:"historyMsg",onEdit:e[5]||(e[5]=(t,v)=>{s.dialogVisibleSendMsg=!0,l.disabledMsg=!0,s.formMsg=t})},null,8,["id"])):C("",!0)]),_:1},8,["modelValue"]),i(p,{title:"发送消息",modelValue:s.dialogVisibleSendMsg,"onUpdate:modelValue":e[7]||(e[7]=t=>s.dialogVisibleSendMsg=t),"close-on-click-modal":!1},{default:o(()=>[s.dialogVisibleSendMsg?(a(),h(U,{key:0,data:s.formMsg,disabled:l.disabledMsg,onSubmit:g.submitSendMsg},null,8,["data","disabled","onSubmit"])):C("",!0)]),_:1},8,["modelValue"])])}const Q=B(z,[["render",K],["__scopeId","data-v-e47e0d75"]]),Y=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));export{R as a,Y as i};
