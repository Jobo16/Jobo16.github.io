import{_ as S,r as n,o as p,c as T,d as f,e as r,i as a,j as s,k as g,f as y,F as V,h as I,t as P,l as q}from"../index-DYxDfolO.js";var _=(o,e,i)=>{/^https?:\/\//gi.test(e)?i():i(new Error("必须以 http://或 https://开头"))};const B={name:"",components:{},props:{data:{type:Object,default:()=>({})},disabled:{type:Boolean}},data(){return{form:Object.assign({scopeType:1,sendType:1,weMessageTemplate:{msgType:"text"}},this.data),rules:Object.freeze({"text.content":[$sdk.ruleRequiredBlur],content:[$sdk.ruleRequiredBlur],fileUrl:[$sdk.ruleRequiredChange],"link.title":[$sdk.ruleRequiredBlur],msgTitle:[$sdk.ruleRequiredBlur],"link.desc":[$sdk.ruleRequiredBlur],"image.picUrl":[$sdk.ruleRequiredBlur],sendTime:[$sdk.ruleRequiredBlur],"link.url":[$sdk.ruleRequiredBlur,{validator:_,trigger:"blur"}]}),typeDict:{text:"文本",image:"图片",link:"图文"},dialogVisible:!1}},computed:{},watch:{data:{handler(o){var e;o=Object.assign({},(e=o.robotSubList)==null?void 0:e[0],o),this.form=o}},"form.msgType"(o,e){if(!this.disabled&&(this.form[this.form.msgType]={},this.$route.query.posterId&&o=="image"&&(this.form.weMessageTemplate.picUrl=this.$route.query.posterId),this.$route.query.isPromotion=="true")){let i=JSON.parse(sessionStorage.promotion);this.form.promotionEntity=i.promotionEntity,i.materialType=="code"?this.form.weMessageTemplate.picUrl=i.linkQrUrl:i.materialType=="text"?this.form.weMessageTemplate.content=i.linkUrl:i.materialType=="link"&&(this.form.weMessageTemplate.picUrl=i.linkImgUrl,this.form.weMessageTemplate.title=i.linkTitle,this.form.weMessageTemplate.desc=i.linkDesc,this.form.weMessageTemplate.linkUrl=i.linkUrl)}}},created(){if(this.form.toParty?typeof this.form.toParty=="string"&&(this.form.toParty=this.form.toParty.split(","),this.form.toPartyName=this.form.toPartyName.split(",")):(this.form.toParty=[],this.form.toPartyName=[]),this.form.toUser?typeof this.form.toUser=="string"&&(this.form.toUser=this.form.toUser.split(","),this.form.toUserName=this.form.toUserName.split(",")):(this.form.toUser=[],this.form.toUserName=[]),this.form.robotId&&delete this.typeDict.video,this.$route.query.posterId&&(this.form.weMessageTemplate.msgType="image",this.form.weMessageTemplate.picUrl=this.$route.query.posterId),this.$route.query.isPromotion=="true"){let o=JSON.parse(sessionStorage.promotion);this.form.promotionEntity=o.promotionEntity,o.materialType=="code"?this.form.weMessageTemplate.picUrl=o.linkQrUrl:o.materialType=="text"?this.form.weMessageTemplate.content=o.linkUrl:o.materialType=="link"&&(this.form.weMessageTemplate.picUrl=o.linkImgUrl,this.form.weMessageTemplate.title=o.linkTitle,this.form.weMessageTemplate.desc=o.linkDesc,this.form.weMessageTemplate.linkUrl=o.linkUrl)}},mounted(){},methods:{selectedUser(o){this.form.toParty=[],this.form.toPartyName=[],this.form.toUser=[],this.form.toUserName=[],o.map(e=>{e.isParty?(this.form.toParty.push(e.userId),this.form.toPartyName.push(e.name)):e.userDepts.some(u=>o.some(l=>l.userId===u.deptId))||(this.form.toUser.push(e.userId),this.form.toUserName.push(e.name))})},async submit(o){var u;let e=JSON.parse(JSON.stringify(this.form)),i=await this.$refs.form.validate();if(i=await this.$refs.formCon.validate(),i)if((u=e.users)==null||u.forEach(l=>{l.userId&&(e.toUserName.push(l.name),e.toUser.push(l.userId))}),e.scopeType==2&&!e.toParty.concat(e.toUser).length)this.msgError("发送范围不能为空");else if(e.sendType==2&&new Date(e.sendTime).getTime()<=Date.now()){if(this.msgError("定时发送时间不能小于当前时间"),this.$route.query.isPromotion=="true"){let l=JSON.parse(sessionStorage.promotion);if(l.marketTimeType==0&&+new Date(e.sendTime)>+new Date(l.marketEndTime)){this.msgError("定时发送时间不得晚于活动结束时间:"+l.marketEndTime);return}}}else e.status=o,this.$emit("submit",e)}}},D={class:""},R={key:2,class:"mt20 ar"};function E(o,e,i,u,l,x){const d=n("el-input"),m=n("el-form-item"),k=n("el-radio"),b=n("el-radio-group"),M=n("SelectStaff"),h=n("el-form"),U=n("Upload"),w=n("el-button");return p(),T("div",{style:{margin:"0 20px"},class:q(i.disabled&&"detail-form")},[l.form.agentId?(p(),f(h,{key:0,class:"mb20",ref:"form",model:l.form,rules:l.rules,disabled:i.disabled,"label-width":"100px"},{default:r(()=>[a("div",D,[e[17]||(e[17]=a("div",{class:"title"},[a("span",null,"消息设置")],-1)),s(m,{label:"消息标题",prop:"msgTitle"},{default:r(()=>[s(d,{modelValue:l.form.msgTitle,"onUpdate:modelValue":e[0]||(e[0]=t=>l.form.msgTitle=t),placeholder:"请输入标题",maxlength:"30","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(m,{label:"发送范围",prop:"scopeType"},{default:r(()=>[s(b,{modelValue:l.form.scopeType,"onUpdate:modelValue":e[1]||(e[1]=t=>l.form.scopeType=t),class:"mr20"},{default:r(()=>[s(k,{label:1},{default:r(()=>[...e[15]||(e[15]=[g("全部",-1)])]),_:1}),s(k,{label:2},{default:r(()=>[...e[16]||(e[16]=[g("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l.form.scopeType==2?(p(),f(M,{key:0,modelValue:l.form.users,"onUpdate:modelValue":e[2]||(e[2]=t=>l.form.users=t),title:"选择员工"},null,8,["modelValue"])):y("",!0)]),_:1})])]),_:1},8,["model","rules","disabled"])):y("",!0),e[24]||(e[24]=a("div",{class:"title"},"消息内容",-1)),l.form.robotId?(p(),f(h,{key:1,class:"",ref:"form",model:l.form,rules:l.rules,disabled:i.disabled,"label-width":"100px"},{default:r(()=>[s(m,{label:"消息标题",prop:"msgTitle"},{default:r(()=>[s(d,{modelValue:l.form.msgTitle,"onUpdate:modelValue":e[3]||(e[3]=t=>l.form.msgTitle=t),placeholder:"请输入标题",maxlength:"30","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"])):y("",!0),s(h,{class:"",ref:"formCon",model:l.form,rules:l.rules,disabled:i.disabled,"label-width":"100px"},{default:r(()=>[s(m,{label:"内容类型",prop:"msgType"},{default:r(()=>[s(b,{modelValue:l.form.msgType,"onUpdate:modelValue":e[4]||(e[4]=t=>l.form.msgType=t)},{default:r(()=>[(p(!0),T(V,null,I(l.typeDict,(t,N,v)=>(p(),f(k,{key:v,label:N},{default:r(()=>[g(P(t),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l.form.msgType==="text"?(p(),f(m,{key:0,label:"文本内容",prop:"text.content"},{default:r(()=>[s(d,{modelValue:l.form.text.content,"onUpdate:modelValue":e[5]||(e[5]=t=>l.form.text.content=t),type:"textarea",autosize:{minRows:2,maxRows:50},placeholder:"请输入内容",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1})):l.form.msgType==="image"?(p(),f(m,{key:1,label:"图片",prop:"image.picUrl"},{default:r(()=>[s(U,{fileUrl:l.form.image.picUrl,"onUpdate:fileUrl":e[6]||(e[6]=t=>l.form.image.picUrl=t),maxSize:2,type:"image"},{tip:r(()=>[...e[18]||(e[18]=[a("div",null,"支持jpg/jpeg/png格式，图片大小不超过2M",-1)])]),_:1},8,["fileUrl"])]),_:1})):l.form.msgType==="link"?(p(),T(V,{key:2},[s(m,{label:"图文地址",prop:"link.url"},{default:r(()=>[s(d,{modelValue:l.form.link.url,"onUpdate:modelValue":e[7]||(e[7]=t=>l.form.link.url=t),type:"text",placeholder:"请输入图文地址，以http://或https://开头"},null,8,["modelValue"])]),_:1}),s(m,{label:"图文标题",prop:"title"},{default:r(()=>[s(d,{modelValue:l.form.link.title,"onUpdate:modelValue":e[8]||(e[8]=t=>l.form.link.title=t),type:"text",maxlength:60,"show-word-limit":"",placeholder:"请输入图文标题"},null,8,["modelValue"])]),_:1}),s(m,{label:"图文描述",prop:"link.desc"},{default:r(()=>[s(d,{modelValue:l.form.link.desc,"onUpdate:modelValue":e[9]||(e[9]=t=>l.form.link.desc=t),type:"textarea",maxlength:100,"show-word-limit":"",autosize:{minRows:2,maxRows:50},placeholder:"请输入"},null,8,["modelValue"])]),_:1}),s(m,{label:"图文封面"},{default:r(()=>[s(U,{fileUrl:l.form.link.picUrl,"onUpdate:fileUrl":e[10]||(e[10]=t=>l.form.link.picUrl=t)},{tip:r(()=>[...e[19]||(e[19]=[a("div",null,"支持jpg/jpeg/png格式，建议200*200",-1)])]),_:1},8,["fileUrl"])]),_:1})],64)):l.form.msgType==="video"?(p(),f(m,{key:3,label:"上传视频",prop:"fileUrl"},{default:r(()=>[s(U,{fileUrl:l.form.fileUrl,"onUpdate:fileUrl":e[11]||(e[11]=t=>l.form.fileUrl=t),maxSize:10,format:["mp4","mov"],type:"2"},{tip:r(()=>[...e[20]||(e[20]=[a("div",null,"支持mp4/mov格式，视频大小不超过10M",-1)])]),_:1},8,["fileUrl"])]),_:1})):l.form.msgType==="file"?(p(),f(m,{key:4,label:"上传文件",prop:"fileUrl"},{default:r(()=>[s(U,{fileUrl:l.form.fileUrl,"onUpdate:fileUrl":e[12]||(e[12]=t=>l.form.fileUrl=t),maxSize:20,type:"3",isThree:!0},{tip:r(()=>[...e[21]||(e[21]=[a("div",null,"支持pdf/ppt/word文件，单个文件大小不超过20M",-1)])]),_:1},8,["fileUrl"])]),_:1})):y("",!0)]),_:1},8,["model","rules","disabled"]),i.disabled?y("",!0):(p(),T("div",R,[s(w,{onClick:e[13]||(e[13]=t=>o.$emit("submit"))},{default:r(()=>[...e[22]||(e[22]=[g("取 消",-1)])]),_:1}),s(w,{type:"primary",onClick:e[14]||(e[14]=t=>x.submit(1))},{default:r(()=>[...e[23]||(e[23]=[g("确 定",-1)])]),_:1})]))],2)}const j=S(B,[["render",E],["__scopeId","data-v-f9dcdb4c"]]);export{j as default};
