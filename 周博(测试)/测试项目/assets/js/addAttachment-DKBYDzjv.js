import{d as V}from"./index-CtSVQMOO.js";import{s as S,r as o,o as a,c as b,d as c,e as l,j as i,k as h,F as L,h as B,C as _,t as A,f as y,K as E,i as J,D as x}from"../index-DYxDfolO.js";const K={key:3},$=S({__name:"addAttachment",props:{form:{type:Object,default:()=>{}},max:{type:[String,Number],default:9},isDetail:{type:Boolean,default:!1}},setup(e,{expose:C}){const f=e,g=x(),v=x(),m=x(0);function N(t,d,u){var s,r;(s=f.form).annexLists??(s.annexLists=[]),m.value=((r=f.form.annexLists)==null?void 0:r.push({msgtype:t,[t]:{}}))-1,setTimeout(()=>{D(g.value)},100)}function M(t,d,u){$sdk.confirm().then(()=>{var s,r;(s=f.form.annexLists)==null||s.splice(t,1),t<=m.value&&(m.value=((r=f.form.annexLists)==null?void 0:r.length)-1)})}function D(t){t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded(!1):t.scrollIntoView({behavior:"smooth",block:"end"})}return C({contentFormRef:v}),(t,d)=>{var k,w;const u=o("el-button"),s=o("el-dropdown-item"),r=o("el-dropdown-menu"),F=o("el-dropdown"),R=o("el-popover"),I=o("el-alert"),T=o("MessageContentForm"),P=o("el-tab-pane"),j=o("el-tabs");return a(),b("div",null,[e.isDetail?y("",!0):(a(),c(R,{key:0,trigger:"hover",content:"最多添加"+e.max+"个",placement:"top-start",disabled:((k=e.form.annexLists)==null?void 0:k.length)<e.max},{reference:l(()=>{var n;return[i(F,{onCommand:N,disabled:((n=e.form.annexLists)==null?void 0:n.length)>=e.max},{dropdown:l(()=>[i(r,{trigger:"click"},{default:l(()=>[(a(!0),b(L,null,B(_(V),(p,G)=>(a(),c(s,{key:G,command:p.type},{default:l(()=>[i(u,{text:""},{default:l(()=>[h(A(p.name),1)]),_:2},1024)]),_:2},1032,["command"]))),128))]),_:1})]),default:l(()=>[i(u,{type:"primary",class:"mb10"},{default:l(()=>[...d[1]||(d[1]=[h("添加",-1)])]),_:1})]),_:1},8,["disabled"])]}),_:1},8,["content","disabled"])),e.isDetail?y("",!0):(a(),c(I,{key:1,class:"mb15",title:"注: 1.图片:10MB,支持JPG,PNG格式; 2.视频:10MB,支持MP4格式; 3.普通文件:20MB",type:"error",closable:!1})),(w=e.form.annexLists)!=null&&w.length?(a(),c(j,{key:2,ref:"tabs",modelValue:_(m),"onUpdate:modelValue":d[0]||(d[0]=n=>E(m)?m.value=n:null),type:"card",class:"",closable:"",onTabRemove:M},{default:l(()=>[(a(!0),b(L,null,B(e.form.annexLists,(n,p)=>(a(),c(P,{key:n.msgtype,label:_(V)[n.msgtype].name,name:p},{default:l(()=>[i(T,{type:n.msgtype,ref_for:!0,ref_key:"contentFormRef",ref:v,form:n[n.msgtype]},null,8,["type","form"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])):e.isDetail?(a(),b("div",K,"暂无附件")):y("",!0),J("div",{ref_key:"bottomRef",ref:g},null,512)])}}});export{$ as default};
