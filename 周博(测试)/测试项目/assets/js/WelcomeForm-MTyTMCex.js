import{d as G}from"./index-CtSVQMOO.js";import{_ as z,r as s,o as u,d as _,e as o,j as l,i as w,c as V,F as v,k as p,h as L,t as S,f as T,y as R}from"../index-DYxDfolO.js";const D={name:"",props:{data:{type:Object,default:()=>{}}},data(){return{dictMsgType:G,max:9,active:0,form:{},originForm:{beginTime:"",endTime:"",workCycle:[],weclomeMsg:"欢迎使用scrm"},rules:{weclomeMsg:[{required:!0,message:"必填项",trigger:"blur"}]}}},computed:{},watch:{data:{deep:!0,immediate:!0,handler(n){let e=JSON.parse(JSON.stringify(n));e!=null&&e.annexLists||(e.annexLists=[]),e!=null&&e.periodAnnexLists?e.periodAnnexLists.forEach((f,m)=>{var t;f.workCycle=((t=f.workCycle)==null?void 0:t.split(","))||[]}):e.periodAnnexLists=[JSON.parse(JSON.stringify(this.originForm))],this.form=e}}},created(){},mounted(){},methods:{add(n,e,f){var m;this.form.startPeriodAnnex?(e.periodMsgAnnexList??(e.periodMsgAnnexList=[]),e.active=e.periodMsgAnnexList.push({msgtype:n,[n]:{}})-1,setTimeout(()=>{this.scrollIntoView(this.$refs.bottom[f])},100)):(this.active=((m=this.form.annexLists)==null?void 0:m.push({msgtype:n,[n]:{}}))-1,setTimeout(()=>{this.scrollIntoView(this.$refs.bottom)},100))},remove(n,e,f){this.$confirm().then(()=>{var m,t,c;this.form.startPeriodAnnex?(e.periodMsgAnnexList.splice(n,1),n<=e.active&&(e.active=e.periodMsgAnnexList.length-1),e.periodMsgAnnexList.length==0&&this.$refs.form.clearValidate("weclomeMsg")):((m=this.form.annexLists)==null||m.splice(n,1),n<=this.active&&(this.active=((t=this.form.annexLists)==null?void 0:t.length)-1),((c=this.form.annexLists)==null?void 0:c.length)==0&&this.$refs.form.clearValidate("weclomeMsg"))})},async submit(){var e;let n=JSON.parse(JSON.stringify(this.form));if(n.startPeriodAnnex){n.annexLists=[];let f=0,m=(e=n.periodAnnexLists)==null?void 0:e.map(async(t,c)=>{var k;t.workCycle+="";let h=(k=t.periodMsgAnnexList)==null?void 0:k.map(async(g,A)=>{let M=await this.$refs.contentForm[f++].submit();return M?(g[g.msgtype]=Object.assign(g[g.msgtype]||{},M),!0):!1});return h?await Promise.all(h):!0});m&&await Promise.all(m)}else{n.periodAnnexLists=[];let f=n.annexLists.map(async(m,t)=>{let c=await this.$refs.contentForm[t].submit();return c?(m[m.msgtype]=Object.assign(m[m.msgtype]||{},c),!0):!1});f&&await Promise.all(f)}return n},scrollIntoView(n){n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded(!1):n.scrollIntoView({behavior:"smooth",block:"end"})}}},W={ref:"bottom"},H={class:"mt20"};function K(n,e,f,m,t,c){const h=s("el-switch"),b=s("el-form-item"),k=s("TextareaExtend"),g=s("el-button"),A=s("el-dropdown-item"),M=s("el-dropdown-menu"),N=s("el-dropdown"),C=s("el-popover"),P=s("el-alert"),F=s("MessageContentForm"),U=s("el-tab-pane"),O=s("el-tabs"),x=s("el-checkbox"),j=s("el-checkbox-group"),B=s("el-time-select"),I=s("el-card"),q=s("el-form");return u(),_(q,{ref:"form",model:t.form,"label-position":"right","label-width":"100px",rules:t.rules,"scroll-into-view-options":!0},{default:o(()=>{var J;return[l(b,{label:"分时段"},{default:o(()=>[l(h,{modelValue:t.form.startPeriodAnnex,"onUpdate:modelValue":e[0]||(e[0]=r=>t.form.startPeriodAnnex=r)},null,8,["modelValue"]),e[4]||(e[4]=w("div",{class:"g-tip"},"开启后，根据添加时间发送当前时段欢迎语",-1))]),_:1}),t.form.startPeriodAnnex?T("",!0):(u(),V(v,{key:0},[l(b,{label:"欢迎语",prop:"weclomeMsg",required:((J=t.form.annexLists)==null?void 0:J.length)>0},{default:o(()=>[l(k,{modelValue:t.form.weclomeMsg,"onUpdate:modelValue":e[1]||(e[1]=r=>t.form.weclomeMsg=r),toolbar:["emoji","insertCustomerNickName"],maxlength:"200","show-word-limit":"",placeholder:"请输入",autosize:{minRows:5,maxRows:20},clearable:"",autofocus:!1},null,8,["modelValue"])]),_:1},8,["required"]),l(b,{label:"欢迎语附件",prop:""},{default:o(()=>{var r;return[l(C,{trigger:"hover",content:"最多添加"+t.max+"个",placement:"top-start",disabled:((r=t.form.annexLists)==null?void 0:r.length)<t.max},{reference:o(()=>{var a;return[l(N,{onCommand:c.add,disabled:((a=t.form.annexLists)==null?void 0:a.length)>=t.max},{dropdown:o(()=>[l(M,{trigger:"click"},{default:o(()=>[(u(!0),V(v,null,L(t.dictMsgType,(i,d)=>(u(),_(A,{key:d,command:i.type},{default:o(()=>[l(g,{text:""},{default:o(()=>[p(S(i.name),1)]),_:2},1024)]),_:2},1032,["command"]))),128))]),_:1})]),default:o(()=>[l(g,{type:"primary",class:"mb10"},{default:o(()=>[...e[5]||(e[5]=[p("添加",-1)])]),_:1})]),_:1},8,["onCommand","disabled"])]}),_:1},8,["content","disabled"]),l(P,{title:"注: 1.图片:10MB,支持JPG,PNG格式; 2.视频:10MB,支持MP4格式; 3.普通文件:20MB",type:"error",closable:!1}),e[6]||(e[6]=w("br",null,null,-1)),l(O,{ref:"tabs",modelValue:t.active,"onUpdate:modelValue":e[2]||(e[2]=a=>t.active=a),type:"card",class:"",closable:"",onTabRemove:c.remove},{default:o(()=>[(u(!0),V(v,null,L(t.form.annexLists,(a,i)=>(u(),_(U,{key:a.msgtype,label:t.dictMsgType[a.msgtype].name,name:i},{default:o(()=>[l(F,{type:a.msgtype,ref_for:!0,ref:"contentForm",form:a[a.msgtype]},null,8,["type","form"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue","onTabRemove"]),w("div",W,null,512)]}),_:1})],64)),t.form.startPeriodAnnex?(u(),_(b,{key:1,required:"",label:"欢迎语"},{default:o(()=>[(u(!0),V(v,null,L(t.form.periodAnnexLists.map(r=>(r.active??(r.active=0),r)),(r,a)=>(u(),_(I,{key:a+"welcom",class:"roster-card"},{default:o(()=>[a!==0?(u(),_(g,{key:0,class:"fr",text:"",icon:"el-icon-delete",onClick:i=>n.$confirm().then(()=>{t.form.periodAnnexLists.splice(a,1)})},{default:o(()=>[...e[7]||(e[7]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])):T("",!0),l(b,{label:"工作周期"},{default:o(()=>[l(j,{modelValue:r.workCycle,"onUpdate:modelValue":i=>r.workCycle=i},{default:o(()=>[l(x,{label:"1"},{default:o(()=>[...e[8]||(e[8]=[p("周一",-1)])]),_:1}),l(x,{label:"2"},{default:o(()=>[...e[9]||(e[9]=[p("周二",-1)])]),_:1}),l(x,{label:"3"},{default:o(()=>[...e[10]||(e[10]=[p("周三",-1)])]),_:1}),l(x,{label:"4"},{default:o(()=>[...e[11]||(e[11]=[p("周四",-1)])]),_:1}),l(x,{label:"5"},{default:o(()=>[...e[12]||(e[12]=[p("周五",-1)])]),_:1}),l(x,{label:"6"},{default:o(()=>[...e[13]||(e[13]=[p("周六",-1)])]),_:1}),l(x,{label:"7"},{default:o(()=>[...e[14]||(e[14]=[p("周日",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(b,{label:"时间段"},{default:o(()=>[l(B,R({modelValue:r.beginTime,"onUpdate:modelValue":i=>r.beginTime=i},{ref_for:!0},{start:"00:00",end:"23:59",step:"00:30"},{style:{width:"160px"},"max-time":r.endTime,placeholder:"选择时间"}),null,16,["modelValue","onUpdate:modelValue","max-time"]),e[15]||(e[15]=p(" —— ",-1)),l(B,R({ref_for:!0},{start:"00:00",end:"23:59",step:"00:30"},{style:{width:"160px"},"min-time":r.beginTime||null,modelValue:r.endTime,"onUpdate:modelValue":i=>r.endTime=i,placeholder:"选择时间"}),null,16,["min-time","modelValue","onUpdate:modelValue"])]),_:2},1024),l(b,{label:"欢迎语"},{default:o(()=>[l(k,{modelValue:r.weclomeMsg,"onUpdate:modelValue":i=>r.weclomeMsg=i,toolbar:["emoji","insertCustomerNickName"],maxlength:"200","show-word-limit":"",placeholder:"请输入欢迎语",autosize:{minRows:5,maxRows:20},clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(b,{label:"欢迎语附件",prop:"",style:{"margin-bottom":"0"}},{default:o(()=>{var i;return[l(C,{trigger:"hover",content:"最多添加"+t.max+"个",placement:"top-start",disabled:((i=r.periodMsgAnnexList)==null?void 0:i.length)<t.max},{reference:o(()=>{var d;return[l(N,{onCommand:y=>c.add(y,r,a),disabled:((d=r.periodMsgAnnexList)==null?void 0:d.length)>=t.max},{dropdown:o(()=>[l(M,{trigger:"click"},{default:o(()=>[(u(!0),V(v,null,L(t.dictMsgType,(y,E)=>(u(),_(A,{key:E,command:y.type},{default:o(()=>[l(g,{text:""},{default:o(()=>[p(S(y.name),1)]),_:2},1024)]),_:2},1032,["command"]))),128))]),_:1})]),default:o(()=>[l(g,{type:"primary",class:"mb10"},{default:o(()=>[...e[16]||(e[16]=[p("添加",-1)])]),_:1})]),_:1},8,["onCommand","disabled"])]}),_:2},1032,["content","disabled"]),l(P,{title:"注: 1.图片:10MB,支持JPG,PNG格式; 2.视频:10MB,支持MP4格式; 3.普通文件:20MB",type:"error",closable:!1}),e[17]||(e[17]=w("br",null,null,-1)),l(O,{ref_for:!0,ref:"tabs",modelValue:r.active,"onUpdate:modelValue":d=>r.active=d,type:"card",class:"",closable:"",onTabRemove:d=>c.remove(d,r,a)},{default:o(()=>[(u(!0),V(v,null,L(r.periodMsgAnnexList,(d,y)=>(u(),_(U,{key:d.msgtype,label:t.dictMsgType[d.msgtype].name,name:y},{default:o(()=>[l(F,{type:d.msgtype,ref_for:!0,ref:"contentForm",form:d[d.msgtype]},null,8,["type","form"])]),_:2},1032,["label","name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onTabRemove"]),w("div",{ref_for:!0,ref:"bottom"},null,512)]}),_:2},1024)]),_:2},1024))),128)),w("div",H,[l(g,{type:"primary",plain:"",onClick:e[3]||(e[3]=r=>t.form.periodAnnexLists.push(JSON.parse(JSON.stringify(t.originForm))))},{default:o(()=>[...e[18]||(e[18]=[p(" +添加工作周期 ",-1)])]),_:1})])]),_:1})):T("",!0)]}),_:1},8,["model","rules"])}const Y=z(D,[["render",K],["__scopeId","data-v-b0425805"]]);export{Y as default};
