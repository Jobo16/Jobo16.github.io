import{u as P}from"./common--EZeVx_X.js";import{_ as j,r as u,o,c as a,F as S,h as z,j as n,i as c,f as d,d as x,e as N,b,T as E,t as C,A as k,k as R}from"../index-DYxDfolO.js";const A={components:{},emits:["update:fileUrl","update:fileName","update:fileList","loadingChange"],props:{fileUrl:{type:String,default:""},fileName:{type:String,default:""},fileList:{type:Array,default:()=>[]},type:{type:String,default:"image",validator:function(e){return["image","video","file"].includes(e)}},maxSize:{type:[Number,String],default:void 0},maxImgPx:{type:Array,default:null},format:{type:Array,default:void 0},accept:{type:String,default:""},multiple:{type:Boolean,default:!1},limit:{type:[Number,String],default:void 0}},data(){return{loading:!1,fileUrlShow:"",fileNameShow:"",fileListShow:"",file:void 0,speed:0,percentage:0}},watch:{fileUrl:{immediate:!0,deep:!0,handler(e){this.fileUrlShow=e}},fileName:{immediate:!0,deep:!0,handler(e){this.fileNameShow=e}},fileList:{immediate:!0,deep:!0,handler(e){this.fileListShow=e}},loading:{immediate:!0,deep:!0,handler(e){this.$emit("loadingChange",e)}}},computed:{acceptAuto(){return{image:"image/*",video:"video/*"}[this.type]}},created(){},mounted(){},methods:{upload(){this.loading=!0;let e;!this.multiple||this.limit==1?e=this.file:e=this.file.shift();let t=new FormData;t.append("file",e),P(t).then(l=>{if(l.code==200){let h=l.data||l.msg;this.loading=!1;let i=window.URL.createObjectURL(e),s=e.name;this.multiple?(this.fileListShow=this.fileListShow.concat({name:s,url:i}),this.$emit("update:fileList",this.fileList.concat({name:s,url:h}))):(this.fileUrlShow=i,this.$emit("update:fileUrl",h),this.$emit("update:fileName",this.fileNameShow=s))}else this.loading=!1,this.$message.error("上传失败，请稍后再试")})},remove(e){this.$confirm().then(()=>{let t=JSON.parse(JSON.stringify(this.fileList));this.fileListShow.splice(e,1),t.splice(e,1),this.$emit("update:fileList",t)})},handleExceed(e,t){this.$message.error("最多上传"+this.limit+"张"),this.loading=!1},async handleBeforeUpload(e,t){this.loading=!0;let l=!0,h=!0,i=this.format,s="";if(!i||!i.length){let r={image:{tip:"png/jpg",value:["png","jpg","jpeg"]},video:{value:["mp4"]},file:{tip:"word/pdf/ppt",value:["doc","docx","pdf","ppt","pptx","pps","pptsx"]}};i=r[this.type].value,s=r[this.type].tip}const U=e.name.split(".").pop();if(l=i[0]==="*"||i.includes(U),!l)return this.$message.error("文件格式错误，仅支持 "+(s||i.join("，"))+" 格式!"),this.loading=!1,Promise.reject();let f=this.maxSize;if(f||f||(f={image:2,video:100,file:50}[this.type]),h=e.size/1024/1024<f,!h)return this.$message.error("上传文件大小不能超过 "+f+"MB!"),this.loading=!1,Promise.reject();let g=!0;if(this.type==="image"){let r=this.maxImgPx;if(r)try{await new Promise(y=>{let w,L,m=new Image;if(m.onload=()=>{w=m.width,L=m.height,w>r[0]?(g=!1,this.$message.error(`图片“宽”度超过${r[0]}像素，请重新选择`)):L>r[1]&&(this.$message.error(`图片“高”度超过${r[1]}像素，请重新选择`),g=!1),window.URL&&window.URL.revokeObjectURL(m.src),y()},window.URL){let p=window.URL.createObjectURL(e);m.src=p}else if(window.FileReader){let p=new FileReader;p.onload=function(v){let _=v.target.result;m.src=_},p.readAsDataURL(e)}})}catch(y){console.error(y)}}return g?!this.multiple||this.limit==1?this.file=e:(Array.isArray(this.file)||(this.file=[]),this.file.push(e)):this.loading=!1,g||Promise.reject()},onError(e,t,l){this.loading=!1,this.$message.error("上传文件失败")},showView(e){(e!==void 0?this.$refs.image[e]:this.$refs.image).$el.firstElementChild.click()}}},B={class:"action-mask"},V={key:0,class:"uploader-icon upload-action uploader-size"},D={class:"upload-action uploader-size",key:1},F={key:1,class:"cc",style:{"margin-top":"35px"}},I={class:"upload-item",key:2},O=["src"],T=["href"],M={class:"tip"};function q(e,t,l,h,i,s){const U=u("el-image"),f=u("el-icon-search"),g=u("el-icon-delete"),r=u("el-icon-plus"),y=u("el-progress"),w=u("el-icon-EditPen"),L=u("el-icon-view"),m=u("el-upload");return o(),a("div",null,[l.multiple?(o(),a(S,{key:0},[l.type=="image"?(o(!0),a(S,{key:0},z(i.fileListShow,(p,v)=>(o(),a("div",{key:v,class:"img-item upload-item"},[n(U,{ref_for:!0,ref:"image",class:"upload-img uploader-size",src:p.url,fit:"contain","preview-src-list":i.fileListShow.map(_=>_.url),alt:""},null,8,["src","preview-src-list"]),c("div",B,[n(f,{class:"el-icon-search action-icon mr5",onClick:_=>s.showView(v)},null,8,["onClick"]),n(g,{class:"el-icon-delete action-icon mr5",onClick:_=>s.remove(v)},null,8,["onClick"])])]))),128)):d("",!0)],64)):d("",!0),!l.multiple||!l.limit||i.fileListShow.length<l.limit?(o(),x(m,{key:1,class:"uploader",action:"/api",accept:l.accept||s.acceptAuto,"http-request":s.upload,data:{mediaType:l.type},"show-file-list":!1,"file-list":i.fileListShow,disabled:i.loading,multiple:l.multiple&&l.limit!=1,limit:l.limit,"on-error":s.onError,"on-exceed":s.handleExceed,"before-upload":s.handleBeforeUpload},{default:N(()=>[b(e.$slots,"default",{},()=>[!i.loading&&!i.fileUrlShow?(o(),a("div",V,[n(r,{class:"el-icon-plus"})])):d("",!0),n(E,null,{default:N(()=>[i.loading?(o(),a("div",D,[i.percentage?(o(),x(y,{key:0,class:"progress cc",type:"circle",percentage:i.percentage},null,8,["percentage"])):d("",!0),t[5]||(t[5]=c("div",{class:"el-loading-spinner"},[c("svg",{viewBox:"25 25 50 50",class:"circular"},[c("circle",{cx:"50",cy:"50",r:"20",fill:"none",class:"path"})])],-1)),i.speed?(o(),a("div",F,C(i.speed+"M/s"),1)):d("",!0)])):d("",!0),!i.loading&&i.fileUrlShow&&!l.multiple?(o(),a("div",I,[l.type==="image"?(o(),a(S,{key:0},[i.fileUrlShow?(o(),x(U,{key:0,ref:"image",src:i.fileUrlShow,class:"upload-img upload-img-single uploader-size","preview-src-list":[i.fileUrlShow],"preview-teleported":"",fit:"contain",onClick:t[0]||(t[0]=k(()=>{},["stop"]))},null,8,["src","preview-src-list"])):d("",!0),c("div",{class:"action-mask",onClick:t[2]||(t[2]=k(()=>{},["self","stop"]))},[n(f,{class:"el-icon-search action-icon",onClick:t[1]||(t[1]=k(p=>s.showView(),["stop"]))}),n(w,{class:"el-icon-EditPen action-icon"})])],64)):l.type==="video"?(o(),a(S,{key:1},[(o(),a("video",{ref:"video",id:"myVideo",class:"upload-video",width:"100%",controls:"","webkit-playsinline":"true",playsinline:"true",autoplay:!1,key:i.fileUrlShow,preload:"auto"},[c("source",{src:i.fileUrlShow,type:"video/mp4"},null,8,O)])),c("div",{class:"action-mask",style:{height:"30%"},onClick:t[3]||(t[3]=k(()=>{},["self","stop"]))},[n(w,{class:"el-icon-EditPen action-icon"})])],64)):(o(),a(S,{key:2},[R(C(i.fileNameShow||i.fileUrlShow)+" ",1),n(w,{class:"el-icon-EditPen ml10"}),c("a",{onClick:t[4]||(t[4]=k(()=>{},["stop"])),href:/\.mp4$/.test(i.fileNameShow)?l.fileUrl:i.fileUrlShow,target:"_blank"},[n(L,{class:"el-icon-view ml10",style:{"vertical-align":"middle"}})],8,T)],64))])):d("",!0)]),_:1})],!0)]),_:3},8,["accept","http-request","data","file-list","disabled","multiple","limit","on-error","on-exceed","before-upload"])):d("",!0),c("div",M,[b(e.$slots,"tip",{},void 0,!0)])])}const H=j(A,[["render",q],["__scopeId","data-v-b35ab0fb"]]);export{H as default};
