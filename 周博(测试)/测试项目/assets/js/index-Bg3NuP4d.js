import{H as N,_ as S,r as s,o as p,d as b,e as a,i as g,j as n,f as C,c as k,F as T,G as L,b as M,t as V,k as w,I as D,C as $,q as P,h as E,x as j}from"../index-DYxDfolO.js";import{g as O}from"./category-DvOjyH99.js";const{get:A,post:G,put:xe,delt:H}=N,q="/material",z=t=>A(`${q}/findAll`,t),I=t=>G(`${q}/saveOrUpdate`,t),F=t=>H(`${q}/${t}`),K=(t,e,l)=>{/\.html$/gi.test(e)?l():l(new Error("必须以 .html 作为后缀"))},J=(t,e,l)=>{/^https?:\/\//gi.test(e)?l():l(new Error("必须以 http://或 https://开头"))},Q={components:{},props:{type:{type:String,default:"0"},isDetail:{type:Boolean,default:!1},isGroup:{type:Boolean,default:!1}},data(){return{rules:Object.freeze({title:[$sdk.ruleRequiredChange],categoryId:[$sdk.ruleRequiredChange],"text.content":[$sdk.ruleRequiredBlur],materialUrl:[$sdk.ruleRequiredChange],"image.picUrl":[{type:"array",...$sdk.ruleRequiredChange}],digest:[$sdk.ruleRequiredBlur],coverUrl:[$sdk.ruleRequiredBlur],"link.url":[$sdk.ruleRequiredBlur,{validator:this.type==11?K:J,trigger:"blur"}]}),treeData:[{}],groupProps:{expandTrigger:"hover",checkStrictly:!0,children:"children",label:"name",value:"id",emitPath:!1},dialogVisibleSelectTag:!1}},computed:{},watch:{},created(){},mounted(){},methods:{getTree(){O(this.type).then(({data:t})=>{t.forEach(e=>{e.children=null}),this.treeData=[{id:"",name:"全部",parentId:"0",hasParent:!1,hasChildren:!0,children:t||[]}]})},action(t={},e){this.$nextTick(()=>{var l;this.getTree(),t.msgtype=$sdk.dictMaterialType[this.type].msgtype,t[l=$sdk.dictMaterialType[this.type].msgtype]??(t[l]={}),this.$refs.dialogRef.action(t),e==null||e()})}}},W={class:"flex --Gap"},X={class:"flex-auto"},Y={key:0,class:"ml10",span:10};function Z(t,e,l,u,o,m){const h=s("el-cascader"),d=s("el-form-item"),c=s("el-input"),v=s("TextareaExtend"),y=s("Upload"),x=s("el-form"),_=s("PhoneChatList"),U=s("BaDialog");return p(),b(U,{ref:"dialogRef",width:"1000px","append-to-body":""},{default:a(({form:r})=>[g("div",W,[g("div",X,[n(x,{ref:"form",model:r,rules:o.rules,"label-width":"100px"},{default:a(()=>[l.isGroup?(p(),b(d,{key:0,label:"选择分组",prop:"categoryId"},{default:a(()=>[n(h,{modelValue:r.categoryId,"onUpdate:modelValue":i=>r.categoryId=i,options:o.treeData[0].children,props:o.groupProps},null,8,["modelValue","onUpdate:modelValue","options","props"])]),_:2},1024)):C("",!0),l.type==="4"?(p(),k(T,{key:1},[n(d,{label:"文本标题",prop:"title"},{default:a(()=>[n(c,{modelValue:r.title,"onUpdate:modelValue":i=>r.title=i,placeholder:"请输入标题",maxlength:"50","show-word-limit":""},null,8,["modelValue","onUpdate:modelValue"]),e[0]||(e[0]=g("div",{class:"g-tip"},"标题对客户不可见，仅用于查询场景",-1))]),_:2},1024),n(d,{label:"文本内容",prop:"text.content"},{default:a(()=>[n(v,{modelValue:r.text.content,"onUpdate:modelValue":i=>r.text.content=i,autosize:{minRows:5,maxRows:50},placeholder:"请输入内容",maxlength:"1000","show-word-limit":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64)):l.type==="0"?(p(),k(T,{key:2},[n(d,{label:"图片标题",prop:"title"},{default:a(()=>[n(c,{modelValue:r.title,"onUpdate:modelValue":i=>r.title=i,placeholder:"请输入",maxlength:50,"show-word-limit":""},null,8,["modelValue","onUpdate:modelValue"]),e[1]||(e[1]=g("div",{class:"g-tip"},"标题对客户不可见，仅用于查询场景",-1))]),_:2},1024),n(d,{label:"图片",prop:"image.picUrl"},{default:a(()=>[n(y,{fileUrl:r.image.picUrl,"onUpdate:fileUrl":i=>r.image.picUrl=i,maxSize:20,multiple:!1,limit:10},{tip:a(()=>[...e[2]||(e[2]=[g("div",null,"支持jpg/jpeg/png格式，图片大小不超过20M",-1)])]),_:1},8,["fileUrl","onUpdate:fileUrl"])]),_:2},1024)],64)):l.type==="9"?(p(),k(T,{key:3},[n(d,{label:"图文地址",prop:"link.url"},{default:a(()=>[n(c,{modelValue:r.link.url,"onUpdate:modelValue":i=>r.link.url=i,type:"text",placeholder:"请输入图文地址，以http://或https://开头"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(d,{label:"图文标题",prop:"title"},{default:a(()=>[n(c,{modelValue:r.title,"onUpdate:modelValue":i=>r.title=i,type:"text",maxlength:32,"show-word-limit":"",placeholder:"请输入图文标题"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(d,{label:"图文描述"},{default:a(()=>[n(c,{modelValue:r.link.desc,"onUpdate:modelValue":i=>r.link.desc=i,type:"textarea",maxlength:128,"show-word-limit":"",autosize:{minRows:3,maxRows:50},placeholder:"请输入图文描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(d,{label:"图文封面"},{default:a(()=>[n(y,{fileUrl:r.link.picUrl,"onUpdate:fileUrl":i=>r.link.picUrl=i},{tip:a(()=>[...e[3]||(e[3]=[g("div",null,"支持jpg/jpeg/png格式，建议200*200",-1)])]),_:1},8,["fileUrl","onUpdate:fileUrl"])]),_:2},1024)],64)):C("",!0)]),_:2},1032,["model","rules"])]),l.type==="0"&&r.id?C("",!0):(p(),k("div",Y,[n(_,{list:[r]},null,8,["list"])]))])]),_:1},512)}const ee=S(Q,[["render",Z],["__scopeId","data-v-1d22b087"]]),te={components:{AddOrEditMaterialDialog:ee},props:{type:{type:String,default:"0"},selected:{type:[Array,String],default:""},isSelect:{type:Boolean,default:!1}},data(){return{getList:z,del:F,save:I,query:{}}},watch:{},computed:{},created(){var t;this.query.msgtype=(t=$sdk.dictMaterialType[this.type])==null?void 0:t.msgtype},mounted(){},methods:{edit(t){this.$refs.dialogRef.action(Object.assign({},t||{categoryId:this.query.categoryId}))}}},le={class:"flex justify-between items-center"};function ne(t,e,l,u,o,m){const h=s("el-input"),d=s("el-form-item"),c=s("el-button"),v=s("el-table-column"),y=s("TableOperateBtn"),x=s("RequestChartTable"),_=s("AddOrEditMaterialDialog"),U=s("LeftRightGroupListPage");return p(),b(U,{ref:"lrPageRef",isDisabledAction:l.isSelect,type:l.type,moduleType:"4",onCurrentChange:e[5]||(e[5]=r=>t.$nextTick(()=>(o.query.categoryId=r.id,t.$refs.rctRef.getList(1))))},{default:a(()=>{var r;return[n(x,{ref:"rctRef",isCreateRequest:!1,params:o.query,request:o.getList,searchBtnType:"icon",onSelectionChange:e[3]||(e[3]=i=>t.$emit("selectionChange",i))},L({query:a(({query:i})=>[n(d,{label:"素材标题",prop:"title"},{default:a(()=>[n(h,{modelValue:i.title,"onUpdate:modelValue":f=>i.title=f,placeholder:"请输入素材标题",clearable:"",onKeyup:e[0]||(e[0]=D(f=>o.getList(1),["enter"]))},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),table:a(({data:i})=>[M(t.$slots,"default",{list:i}),n(v,{label:"最近更新",align:"center"},{default:a(({row:f})=>[g("div",null,V(f.updateBy),1),g("span",null,V(f.updateTime),1)]),_:1}),l.isSelect?C("",!0):(p(),b(v,{key:0,label:"操作",fixed:"right"},{default:a(({row:f})=>[n(y,{type:"edit",onClick:R=>m.edit(f)},{default:a(()=>[...e[7]||(e[7]=[w("编辑",-1)])]),_:1},8,["onClick"]),n(y,{type:"delete",onClick:R=>t.$refs.rctRef.apiConfirm(o.del,f.id)},{default:a(()=>[...e[8]||(e[8]=[w("删除",-1)])]),_:1},8,["onClick"])]),_:1}))]),_:2},[l.isSelect?void 0:{name:"operation",fn:a(({selectedIds:i})=>[g("div",le,[n(c,{type:"primary",onClick:e[1]||(e[1]=f=>m.edit())},{default:a(()=>{var f;return[w("新建"+V((f=t.$sdk.dictMaterialType[l.type])==null?void 0:f.name),1)]}),_:1}),n(c,{type:"primary",plain:"",disabled:!(i!=null&&i.length),onClick:e[2]||(e[2]=f=>{var R;return(R=t.$refs.rctRef)==null?void 0:R.apiConfirm(o.del)})},{default:a(()=>[...e[6]||(e[6]=[w(" 批量删除 ",-1)])]),_:1},8,["disabled"])])]),key:"0"}]),1032,["params","request"]),n(_,{ref:"dialogRef",type:l.type,isGroup:"",dynamicTitle:(r=t.$sdk.dictMaterialType[l.type])==null?void 0:r.name,onConfirm:e[4]||(e[4]=({visible:i,loading:f})=>t.$refs.dialogRef.$refs.form.validate().then(()=>t.$refs.dialogRef.$refs.dialogRef.confirm(()=>o.save(t.$refs.dialogRef.$refs.dialogRef.form),()=>t.$refs.rctRef.getList(1))).finally(()=>f.value=!1))},null,8,["type","dynamicTitle"])]}),_:3},8,["isDisabledAction","type"])}const B=S(te,[["render",ne]]),ae=["innerHTML"],oe={class:"truncate"},ie={__name:"text",setup(t){return(e,l)=>{const u=s("el-table-column"),o=s("el-tooltip");return p(),b($(B),{ref:"page",type:"4"},{default:a(({list:m})=>[n(u,{label:"文本标题",prop:"title","show-overflow-tooltip":!0}),n(u,{label:"文本内容",prop:"content"},{default:a(({row:h})=>[n(o,{effect:"dark",placement:"top"},{content:a(()=>{var d;return[g("p",{style:{"white-space":"pre-line"},innerHTML:(d=h.text)==null?void 0:d.content},null,8,ae)]}),default:a(()=>{var d;return[g("div",oe,V((d=h.text)==null?void 0:d.content),1)]}),_:2},1024)]),_:1})]),_:1},512)}}},se={__name:"image",setup(t){return(e,l)=>{const u=s("el-table-column"),o=s("el-image"),m=s("el-popover");return p(),b($(B),{ref:"page",type:"0"},{default:a(({list:h})=>[n(u,{label:"标题",prop:"title","show-overflow-tooltip":!0}),n(u,{label:"图片",prop:"content"},{default:a(({row:d})=>[n(m,{placement:"bottom",trigger:"hover"},{reference:a(()=>{var c;return[n(o,{class:"--RadiusSmall w-[50px] h-[50px]",src:(c=d.image)==null?void 0:c.picUrl},null,8,["src"])]}),default:a(()=>{var c;return[n(o,{class:"--Radius w-[200px] h-[200px]",src:(c=d.image)==null?void 0:c.picUrl},null,8,["src"])]}),_:2},1024)]),_:1})]),_:1},512)}}},re={props:{data:{type:Object,default:{}},titleNum:{type:Number,default:12},contentNum:{type:Number,default:50},width:{type:String,default:"200px"}},watch:{},data(){return{}},mounted(){},methods:{coverContent(t,e){return t&&t.length>e&&(t=t.substr(0,e)+"..."),t}}},de={class:"cp flex aic"},ce={style:{"text-align":"left"}},ue=["innerHTML"],pe={style:{color:"var(--font-black-7)","text-align":"left"}};function me(t,e,l,u,o,m){var y,x;const h=s("el-image"),d=s("svg-icon"),c=s("el-popover"),v=s("el-tooltip");return p(),k("div",de,[n(c,{placement:"bottom",trigger:"hover"},{reference:a(()=>{var _,U;return[(_=l.data.link)!=null&&_.picUrl?(p(),b(h,{key:0,class:"--RadiusSmall w-[50px] h-[50px] flex-none",src:(U=l.data.link)==null?void 0:U.picUrl,fit:"contain"},null,8,["src"])):(p(),b(d,{key:1,class:"text-[50px]",icon:"imgText"}))]}),default:a(()=>{var _;return[n(h,{class:"--Radius w-[200px] h-[200px]",src:(_=l.data.link)==null?void 0:_.picUrl,fit:"contain"},null,8,["src"])]}),_:1}),g("div",{class:"ml10",style:P({"max-width":l.width})},[n(v,{content:l.data.title,placement:"top",disabled:l.data.title?l.data.title.length<l.titleNum:!0},{default:a(()=>[g("p",ce,V(m.coverContent(l.data.title,l.titleNum)),1)]),_:1},8,["content","disabled"]),n(v,{placement:"top",disabled:(y=l.data.link)!=null&&y.desc?((x=l.data.link)==null?void 0:x.desc.length)<l.contentNum:!0},{content:a(()=>{var _;return[g("p",{style:{"white-space":"pre-line"},innerHTML:(_=l.data.link)==null?void 0:_.desc},null,8,ue)]}),default:a(()=>{var _;return[g("p",pe,V(m.coverContent((_=l.data.link)==null?void 0:_.desc,l.contentNum)),1)]}),_:1},8,["disabled"])],4)])}const _e=S(re,[["render",me]]),fe={__name:"imageText",setup(t){return(e,l)=>{const u=s("el-table-column");return p(),b($(B),{ref:"page",type:"9"},{default:a(({list:o})=>[n(u,{label:"图文",prop:"materialName",width:"260"},{default:a(({row:m})=>[n($(_e),{data:m},null,8,["data"])]),_:1})]),_:1},512)}}},ge={props:{isSelect:{type:Boolean,default:!1}},components:{},data(){return{activeName:"0",list:[{label:"文本",name:"text",component:ie},{label:"图片",name:"image",component:se},{label:"图文",name:"imageText",component:fe}],selected:[]}},methods:{selectionChange(t){let e=t.filter(u=>{var o;return!((o=this.selected[this.activeName])!=null&&o.some(m=>m.id===u.id))});if(this.selected.reduce((u,o)=>u+=o.length,0)+e.length>9){$sdk.msgError("最多只能选择9个素材"),e.forEach(u=>{this.$refs.maPage[this.activeName].$refs.page.$refs.rctRef.toggleRowSelection(u,!1)});return}this.selected[this.activeName]=t,this.$emit("selectionChange",this.selected.reduce((u,o)=>u.concat(o),[]))}},created(){this.$store.setBusininessDesc(`
      <div>文本、图片等基础素材，可直接用于聊天话术、欢迎语等场景</div>
    `)}};function he(t,e,l,u,o,m){const h=s("el-tab-pane"),d=s("CacheElTabs");return p(),k("div",null,[n(d,{modelValue:o.activeName,"onUpdate:modelValue":e[1]||(e[1]=c=>o.activeName=c)},{default:a(({opened:c})=>[(p(!0),k(T,null,E(o.list,(v,y)=>(p(),b(h,{key:y,label:v.label},{default:a(()=>[c.includes(y+"")?(p(),b(j(v.component),{key:0,isSelect:l.isSelect,ref_for:!0,ref:"maPage",onSelectionChange:e[0]||(e[0]=x=>l.isSelect&&m.selectionChange(x))},null,40,["isSelect"])):C("",!0)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])}const ye=S(ge,[["render",he]]),ke=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{ee as A,ke as a,ye as i};
